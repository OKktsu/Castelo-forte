<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Castelo Forte - Protótipo Mobile</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #001a3a;
        }
        :root {
            --fundo-principal: #002147;
            --fundo-card: #0a2b52;
            --fundo-elemento: #0a2b52;
            --cor-texto-principal: #FFFFFF;
            --cor-texto-secundario: #a0aec0;
            --cor-borda: #1e3a5f;
            --cor-acento-dourado: #C4A35A;
            --cor-acento-dourado-hover: #b89854;
            --cor-receita: #34C759;
            --cor-despesa: #FF3B30;
            --cor-transferencia: #a0aec0;
            --cor-moradia: #FF6384;
            --cor-alimentacao: #FF9F40;
            --cor-transporte: #4BC0C0;
            --cor-viagem: #36A2EB;
        }

        .mobile-screen-content::-webkit-scrollbar, .card-carousel::-webkit-scrollbar { display: none; }
        .mobile-screen-content, .card-carousel { -ms-overflow-style: none; scrollbar-width: none; }
        
        .transaction-type-btn, .theme-btn, .filter-chip-btn, .category-btn, .answer-btn, .toggle-btn, .view-tab-btn {
            background-color: transparent;
            transition: all 0.2s ease-in-out;
        }
        .toggle-btn.selected, .filter-chip-btn.selected, .answer-btn.selected {
            background-color: var(--cor-acento-dourado);
            color: black;
            font-weight: bold;
            border-color: var(--cor-acento-dourado);
        }
        .transaction-type-tab-btn.selected, .view-tab-btn.selected {
            background-color: var(--cor-acento-dourado);
            color: black;
            font-weight: 600;
        }

        .card-carousel {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            gap: 1rem;
            cursor: grab;
            user-select: none;
        }
        .card-carousel.active { cursor: grabbing; }
        .card-carousel > * {
            scroll-snap-align: start;
            flex-shrink: 0;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-sm h-[85vh] min-h-[640px] rounded-3xl shadow-2xl border-8 border-black overflow-hidden">
        <div id="app-container" class="w-full h-full bg-[var(--fundo-principal)] text-[var(--cor-texto-principal)] relative">
            
            <!-- Hidden template for all transactions -->
            <div id="all-transactions-template" class="hidden">
                <div class="transaction-item" data-source-type="account" data-type="expense" data-title="Supermercado" data-category="Alimentação" data-value="- R$ 650,20" data-date="03 de Julho, 2025" data-account="Conta Corrente" data-status="pago" data-description="Compra mensal de supermercado."></div>
                <div class="transaction-item" data-source-type="account" data-type="transfer" data-title="Transferência" data-category="Transferência" data-value="- R$ 500,00" data-date="03 de Julho, 2025" data-account="Conta Poupança" data-status="pago" data-description="Transferência para cobrir despesas na conta corrente."></div>
                <div class="transaction-item" data-source-type="account" data-type="income" data-title="Salário Empresa X" data-category="Salário" data-value="+ R$ 5.000,00" data-date="02 de Julho, 2025" data-account="Conta Corrente" data-status="pago" data-description="Recebimento do salário mensal."></div>
                <div class="transaction-item" data-source-type="account" data-type="expense" data-title="Aluguel" data-category="Moradia" data-value="- R$ 1.500,00" data-date="02 de Julho, 2025" data-account="Conta Corrente" data-status="pendente" data-description="Pagamento do aluguel do apartamento."></div>
                <div class="transaction-item" data-source-type="card" data-type="expense" data-title="iFood" data-category="Alimentação" data-value="- R$ 54,30" data-date="01 de Julho, 2025" data-account="Castelo Bank Final 1234" data-status="pago" data-description="Pedido de almoço."></div>
                <div class="transaction-item" data-source-type="card" data-type="expense" data-title="Netflix" data-category="Lazer" data-value="- R$ 39,90" data-date="30 de Junho, 2025" data-account="Castelo Bank Final 1234" data-status="pago" data-description="Mensalidade Netflix."></div>
            </div>

            <div id="screen-0" class="screen w-full h-full flex flex-col items-center justify-center p-6 z-10">
                <div class="w-full max-w-md text-center">
                    <img src="https://placehold.co/224x100/002147/C4A35A?text=Castelo+Forte" alt="Logo Castelo Forte" class="mx-auto w-56 mb-8 rounded-lg">
                    <form class="space-y-4" onsubmit="event.preventDefault();">
                        <input type="email" required class="appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md focus:outline-none focus:ring-[var(--cor-acento-dourado)] focus:border-[var(--cor-acento-dourado)] sm:text-sm" placeholder="Email">
                        <input type="password" required class="appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md focus:outline-none focus:ring-[var(--cor-acento-dourado)] focus:border-[var(--cor-acento-dourado)] sm:text-sm" placeholder="Senha">
                        <button type="button" class="w-full flex justify-center py-3 px-4 border border-transparent text-sm font-bold rounded-md text-[var(--fundo-principal)] bg-[var(--cor-acento-dourado)] hover:bg-[var(--cor-acento-dourado-hover)] transition-colors" onclick="showScreen(1)">Entrar</button>
                    </form>
                    <div class="mt-6">
                        <div class="relative"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-[var(--cor-borda)]"></div></div><div class="relative flex justify-center text-sm"><span class="px-2 bg-[var(--fundo-principal)] text-[var(--cor-texto-secundario)]">ou entre com</span></div></div>
                        <div class="mt-4"><button type="button" class="w-full inline-flex justify-center py-2 px-4 border border-[var(--cor-borda)] rounded-md shadow-sm bg-[var(--fundo-elemento)] text-sm font-medium text-[var(--cor-texto-principal)] hover:bg-opacity-80 transition-colors"><svg class="w-5 h-5 mr-3" aria-hidden="true" fill="currentColor" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/><path d="M1 1h22v22H1z" fill="none"/></svg><span>Google</span></button></div>
                    </div>
                    <p class="mt-8 text-center text-sm text-[var(--cor-texto-secundario)]">Não tem uma conta? <a href="#" class="font-medium text-[var(--cor-acento-dourado)] hover:text-[var(--cor-acento-dourado-hover)] transition-colors">Crie uma conta</a></p>
                </div>
            </div>

            <div id="screen-1" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-20 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                    <div id="profile-pic" class="flex items-center space-x-3 cursor-pointer">
                        <img class="w-12 h-12 rounded-full border-2 border-[var(--cor-acento-dourado)]" src="https://placehold.co/100x100/0a2b52/C4A35A?text=U" alt="Avatar do usuário">
                        <div>
                            <p class="text-sm text-[var(--cor-texto-secundario)]">Boa tarde,</p>
                            <p class="font-bold text-[var(--cor-texto-principal)]">Usuário</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <i id="plans-btn" data-lucide="gem" class="w-6 h-6 text-[var(--cor-texto-secundario)] hover:text-[var(--cor-acento-dourado)] transition-colors cursor-pointer" onclick="showScreen(16)"></i>
                        <i id="notifications-btn" data-lucide="bell" class="w-6 h-6 text-[var(--cor-texto-secundario)] hover:text-[var(--cor-acento-dourado)] transition-colors cursor-pointer" onclick="showScreen(9)"></i>
                    </div>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content pb-24 space-y-6">
                    <div class="bg-[var(--fundo-elemento)] p-5 rounded-xl">
                        <div class="flex justify-between items-center">
                            <h3 class="text-sm text-[var(--cor-texto-secundario)]">Saldo disponível</h3>
                            <button id="toggle-balance-btn"><i data-lucide="eye" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i></button>
                        </div>
                        <p id="balance-amount" class="text-3xl font-bold text-[var(--cor-acento-dourado)] mt-1">R$ 12.450,75</p>
                    </div>
                    
                    <div id="questionnaire-card" class="bg-[var(--fundo-elemento)] p-5 rounded-xl text-center cursor-pointer hover:bg-white/10">
                        <div class="flex justify-center items-center space-x-2"><i data-lucide="file-text" class="w-8 h-8 text-[var(--cor-acento-dourado)]"></i></div>
                        <h3 class="text-lg font-bold text-[var(--cor-texto-principal)] mt-4">Descubra seu Perfil Financeiro</h3>
                        <p class="text-sm text-[var(--cor-texto-secundario)] mt-2">Responda algumas perguntas para entendermos melhor seus objetivos.</p>
                        <button class="w-full mt-4 py-3 px-4 text-sm font-bold rounded-md text-[var(--fundo-principal)] bg-[var(--cor-acento-dourado)] hover:bg-[var(--cor-acento-dourado-hover)] transition-colors duration-300">Começar Questionário</button>
                    </div>

                    <div>
                        <div class="flex justify-between items-center mb-3 px-1">
                            <h3 class="text-md font-semibold text-[var(--cor-texto-principal)]">Contas</h3>
                            <a href="#" class="text-sm font-semibold text-[var(--cor-acento-dourado)] hover:opacity-80" onclick="showScreen(23)">Ver todas</a>
                        </div>
                        <div id="accounts-carousel" class="card-carousel">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <div>
                        <div class="flex justify-between items-center mb-3 px-1">
                            <h3 class="text-md font-semibold text-[var(--cor-texto-principal)]">Meus Cartões</h3>
                            <a href="#" class="text-sm font-semibold text-[var(--cor-acento-dourado)] hover:opacity-80" onclick="showScreen(24)">Ver todos</a>
                        </div>
                        <div id="cards-carousel" class="card-carousel">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    
                    <div>
                        <div class="flex justify-between items-center mb-3 px-1">
                            <h3 class="text-md font-semibold text-[var(--cor-texto-principal)]">Últimos Lançamentos</h3>
                            <a href="#" class="text-sm font-semibold text-[var(--cor-acento-dourado)] hover:opacity-80" onclick="showScreen(2)">Ver todos</a>
                        </div>
                        <div id="recent-transactions-carousel" class="card-carousel">
                           <!-- Populated by JS -->
                        </div>
                    </div>

                    <div class="bg-[var(--fundo-elemento)] p-5 rounded-xl">
                        <h3 class="text-md font-semibold text-[var(--cor-texto-principal)] mb-4">Despesas por Categoria</h3>
                        <div class="h-40"><canvas id="dashboard-pie-chart"></canvas></div>
                    </div>
                    
                    <div class="bg-[var(--fundo-elemento)] p-5 rounded-xl text-center"><div class="flex justify-center items-center space-x-2"><i data-lucide="wallet" class="w-8 h-8 text-[var(--cor-acento-dourado)]"></i><i data-lucide="link" class="w-6 h-6 text-[var(--cor-texto-secundario)]"></i><i data-lucide="landmark" class="w-8 h-8 text-[var(--cor-acento-dourado)]"></i></div><h3 class="text-lg font-bold text-[var(--cor-texto-principal)] mt-4">Conexão Bancária</h3><p class="text-sm text-[var(--cor-texto-secundario)] mt-2">Conecte seus bancos e importe seus lançamentos.</p><button class="w-full mt-4 py-3 px-4 text-sm font-bold rounded-md text-[var(--fundo-principal)] bg-[var(--cor-acento-dourado)] hover:bg-[var(--cor-acento-dourado-hover)] transition-colors duration-300">Começar agora</button></div>
                </main>
            </div>

            <div id="screen-2" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                    <h1 class="text-xl font-bold text-[var(--cor-texto-principal)]">Lançamentos</h1>
                    <button id="open-filter-btn" class="p-2 rounded-full hover:bg-white/10 transition-colors">
                        <i data-lucide="filter" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                    </button>
                </header>
                <div class="p-2 bg-[var(--fundo-principal)] border-b border-[var(--cor-borda)]">
                    <div id="view-tabs" class="grid grid-cols-3 gap-1 text-sm p-1 bg-[var(--fundo-card)] rounded-lg">
                        <button data-view="contas" class="view-tab-btn py-2 rounded-md">Contas</button>
                        <button data-view="cartoes" class="view-tab-btn py-2 rounded-md">Cartões</button>
                        <button data-view="todos" class="view-tab-btn py-2 rounded-md selected">Todos</button>
                    </div>
                </div>
                <main class="flex-1 overflow-y-auto mobile-screen-content pb-36">
                    <div class="p-4 sticky top-0 bg-[var(--fundo-principal)] z-10">
                        <div class="flex justify-between items-center text-center">
                            <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer prev-month-btn"></i>
                            <div class="flex-1 flex flex-col items-center">
                                <span class="text-xs text-[var(--cor-texto-secundario)] year-display"></span>
                                <div class="flex justify-center items-center space-x-2 mt-1">
                                    <span class="text-[var(--cor-texto-secundario)] prev-month-text"></span>
                                    <span class="py-2 px-4 bg-[var(--fundo-elemento)] text-[var(--cor-texto-principal)] font-bold rounded-full month-display"></span>
                                    <span class="text-[var(--cor-texto-secundario)] next-month-text"></span>
                                </div>
                            </div>
                            <i data-lucide="chevron-right" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer next-month-btn"></i>
                        </div>
                    </div>
                    <div id="transaction-list" class="px-4 space-y-1">
                        <!-- Transactions will be rendered here by JS -->
                    </div>
                </main>
                <footer class="bg-black/20 absolute bottom-20 left-0 right-0 h-16 backdrop-blur-sm border-t border-[var(--cor-borda)]">
                    <div class="grid grid-cols-3 h-full text-center">
                        <div class="flex flex-col justify-center"><p class="text-xs text-[var(--cor-texto-secundario)]">Entradas</p><p class="font-bold text-[var(--cor-receita)]">R$ 5.000,00</p></div>
                        <div class="flex flex-col justify-center"><p class="text-xs text-[var(--cor-texto-secundario)]">Saídas</p><p class="font-bold text-[var(--cor-despesa)]">-R$ 2.650,20</p></div>
                        <div class="flex flex-col justify-center"><p class="text-xs text-[var(--cor-texto-secundario)]">Saldo</p><p class="font-bold text-[var(--cor-acento-dourado)]">+R$ 2.349,80</p></div>
                    </div>
                </footer>
            </div>
            
            <div id="screen-3" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]"><h1 class="text-xl font-bold text-[var(--cor-texto-principal)]">Relatórios</h1></header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content pb-24 space-y-5">
                    <div class="flex justify-between items-center text-center">
                        <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer prev-month-btn"></i>
                        <div class="flex-1 flex flex-col items-center">
                            <span class="text-xs text-[var(--cor-texto-secundario)] year-display"></span>
                            <div class="flex justify-center items-center space-x-2 mt-1">
                                <span class="text-[var(--cor-texto-secundario)] prev-month-text"></span>
                                <span class="py-2 px-4 bg-[var(--fundo-elemento)] text-[var(--cor-texto-principal)] font-bold rounded-full month-display"></span>
                                <span class="text-[var(--cor-texto-secundario)] next-month-text"></span>
                            </div>
                        </div>
                        <i data-lucide="chevron-right" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer next-month-btn"></i>
                    </div>
                    <div class="bg-[var(--fundo-elemento)] p-5 rounded-xl">
                        <h3 class="text-md font-semibold text-[var(--cor-texto-principal)] mb-4">Entradas vs Saídas</h3>
                        <div class="h-40"><canvas id="mainBarChart"></canvas></div>
                    </div>
                    <div class="bg-[var(--fundo-elemento)] p-5 rounded-xl">
                        <h3 class="text-md font-semibold text-[var(--cor-texto-principal)] mb-4">Despesas por Categoria</h3>
                        <div class="h-40 mb-4"><canvas id="pieChart"></canvas></div>
                        <div class="space-y-3">
                            <div>
                                <div class="flex justify-between items-center text-sm mb-1">
                                    <span class="flex items-center"><span class="w-2 h-2 rounded-full mr-2" style="background-color: var(--cor-moradia);"></span>Moradia</span>
                                    <span>R$ 1.500,00</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-1.5"><div class="h-1.5 rounded-full" style="width: 56.6%; background-color: var(--cor-moradia);"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center text-sm mb-1">
                                    <span class="flex items-center"><span class="w-2 h-2 rounded-full mr-2" style="background-color: var(--cor-alimentacao);"></span>Alimentação</span>
                                    <span>R$ 650,20</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-1.5"><div class="h-1.5 rounded-full" style="width: 24.5%; background-color: var(--cor-alimentacao);"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center text-sm mb-1">
                                    <span class="flex items-center"><span class="w-2 h-2 rounded-full mr-2" style="background-color: var(--cor-transporte);"></span>Transporte</span>
                                    <span>R$ 500,00</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-1.5"><div class="h-1.5 rounded-full" style="width: 18.9%; background-color: var(--cor-transporte);"></div></div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

            <div id="screen-4" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                    <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(8)"></i>
                    <h1 id="goal-detail-title" class="text-lg font-semibold text-[var(--cor-texto-principal)]">Bares e Restaurantes</h1>
                    <div class="flex items-center space-x-4">
                       <i data-lucide="edit-3" class="w-5 h-5 text-[var(--cor-texto-secundario)] cursor-pointer"></i>
                       <i id="delete-goal-btn" data-lucide="trash-2" class="w-5 h-5 text-[var(--cor-texto-secundario)] cursor-pointer"></i>
                    </div>
                </header>
                <main class="flex-1 overflow-y-auto mobile-screen-content pb-24 relative">
                    <div class="p-4">
                        <div class="flex justify-between items-center text-center">
                            <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer prev-month-btn"></i>
                            <div class="flex-1 flex flex-col items-center">
                                <span class="text-xs text-[var(--cor-texto-secundario)] year-display"></span>
                                <div class="flex justify-center items-center space-x-2 mt-1">
                                    <span class="text-[var(--cor-texto-secundario)] prev-month-text"></span>
                                    <span class="py-2 px-4 bg-[var(--fundo-elemento)] text-[var(--cor-texto-principal)] font-bold rounded-full month-display"></span>
                                    <span class="text-[var(--cor-texto-secundario)] next-month-text"></span>
                                </div>
                            </div>
                            <i data-lucide="chevron-right" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer next-month-btn"></i>
                        </div>
                    </div>

                    <div class="px-4 py-4 flex space-x-4 border-y border-[var(--cor-borda)]">
                        <div class="flex-1">
                            <p class="text-sm text-[var(--cor-texto-secundario)] flex items-center">Disponível <i data-lucide="info" class="w-3 h-3 ml-1"></i></p>
                            <p class="text-2xl font-bold text-[var(--cor-texto-principal)]">R$ 9,00</p>
                            <p class="text-xs text-[var(--cor-texto-secundario)]">de R$ 100,00</p>
                        </div>
                        <div class="w-2.5 h-auto bg-[var(--fundo-elemento)] rounded-full overflow-hidden">
                            <div class="bg-[var(--cor-acento-dourado)] h-full w-full rounded-full" style="transform: translateY(91%);"></div>
                        </div>
                    </div>
                    
                    <div class="px-4 pt-4">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-md font-semibold text-[var(--cor-texto-principal)]">Lançamentos do mês</h3>
                            <i data-lucide="search" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                        </div>
                        <div class="space-y-2">
                            <p class="text-sm font-bold text-[var(--cor-texto-secundario)]">Hoje</p>
                            <div class="flex justify-between items-center py-2 border-b border-[var(--cor-borda)]">
                                <div class="flex items-center"><div class="w-10 h-10 flex items-center justify-center rounded-full bg-[var(--fundo-elemento)] mr-3"><i data-lucide="utensils" class="w-5 h-5 text-[var(--cor-texto-principal)]"></i></div><div><p class="font-semibold text-[var(--cor-texto-principal)]">Bares e Restaurantes</p><p class="text-xs text-[var(--cor-texto-secundario)]">Conta inicial</p></div></div>
                                <div class="text-right">
                                    <p class="font-bold text-[var(--cor-despesa)]">- R$ 90,00</p>
                                    <p class="text-xs text-[var(--cor-texto-secundario)]">pago</p>
                                </div>
                            </div>
                            <div class="flex justify-between items-center py-2">
                                <div class="flex items-center"><div class="w-10 h-10 flex items-center justify-center rounded-full bg-[var(--fundo-elemento)] mr-3"><i data-lucide="utensils" class="w-5 h-5 text-[var(--cor-texto-principal)]"></i></div><div><p class="font-semibold text-[var(--cor-texto-principal)]">Bares e Restaurantes</p><p class="text-xs text-[var(--cor-texto-secundario)]">Conta inicial</p></div></div>
                                <div class="text-right">
                                    <p class="font-bold text-[var(--cor-despesa)]">- R$ 1,00</p>
                                    <p class="text-xs text-[var(--cor-texto-secundario)]">pago</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button id="add-goal-transaction-btn" class="absolute bottom-6 right-4 bg-[var(--cor-acento-dourado)] text-[var(--fundo-principal)] w-14 h-14 rounded-full flex items-center justify-center shadow-lg hover:bg-[var(--cor-acento-dourado-hover)] transition-colors">
                        <i data-lucide="plus" class="w-8 h-8"></i>
                    </button>
                </main>
            </div>

            <div id="screen-5" class="screen hidden w-full h-full flex flex-col bg-[var(--fundo-principal)]">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                <i data-lucide="x" class="w-6 h-6 text-[var(--cor-texto-secundario)] close-modal cursor-pointer" onclick="showScreen(1)"></i>
                    <h1 class="text-xl font-bold text-[var(--cor-texto-principal)]">Novo Lançamento</h1>
                    <div class="w-6"></div> </header>
                
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content">
                    <form id="new-transaction-form" class="space-y-6">
                        <div id="new-transaction-type-tabs" class="grid grid-cols-3 gap-1 text-sm p-1 bg-[var(--fundo-card)] rounded-lg">
                            <button type="button" data-type="expense" class="transaction-type-tab-btn py-2 rounded-md text-[var(--cor-texto-secundario)]">Despesa</button>
                            <button type="button" data-type="income" class="transaction-type-tab-btn py-2 rounded-md text-[var(--cor-texto-secundario)]">Receita</button>
                            <button type="button" data-type="transfer" class="transaction-type-tab-btn py-2 rounded-md text-[var(--cor-texto-secundario)]">Transferência</button>
                        </div>
                
                        <div class="text-center">
                            <label id="new-value-label" for="new-transaction-value" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Valor</label>
                            <input type="text" id="new-transaction-value" required class="text-5xl font-bold text-center w-full bg-transparent border-none focus:ring-0 p-0" placeholder="R$ 0,00">
                        </div>
                
                        <div>
                            <label for="new-transaction-name" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Descrição</label>
                            <input type="text" id="new-transaction-name" required class="mt-1 appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md focus:outline-none focus:ring-[var(--cor-acento-dourado)] focus:border-[var(--cor-acento-dourado)] sm:text-sm" placeholder="Ex: Tênis novo">
                        </div>
                
                        <div id="new-category-section">
                            <label class="text-sm font-medium text-[var(--cor-texto-secundario)]">Categoria</label>
                            <a href="#" id="new-category-selector-link" class="flex items-center justify-between p-4 bg-[var(--fundo-elemento)] rounded-lg w-full text-left hover:bg-white/10 transition-colors">
                                <div id="new-category-selector" class="flex items-center">
                                    <i data-lucide="shopping-cart" class="w-5 h-5 text-[var(--cor-acento-dourado)] mr-3"></i>
                                    <span>Alimentação</span>
                                </div>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                            </a>
                        </div>
                        
                        <div id="new-goal-selection-section" class="hidden">
                            <label class="text-sm font-medium text-[var(--cor-texto-secundario)]">Meta</label>
                            <a href="#" class="flex items-center justify-between p-4 bg-[var(--fundo-elemento)] rounded-lg w-full text-left hover:bg-white/10 transition-colors" onclick="showScreen(22)">
                                <div id="new-goal-selector" class="flex items-center">
                                    <i data-lucide="target" class="w-5 h-5 text-[var(--cor-acento-dourado)] mr-3"></i>
                                    <span>Selecionar Meta</span>
                                </div>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                            </a>
                        </div>
                
                        <div id="new-expense-options" class="space-y-6 hidden">
                            <div>
                                <label class="text-sm font-medium text-[var(--cor-texto-secundario)]">Forma de pagamento</label>
                                <div id="new-payment-source" class="mt-2 grid grid-cols-2 gap-2 text-sm">
                                    <button type="button" data-source="card" class="toggle-btn py-3 px-2 rounded-md border-2 border-[var(--cor-borda)]">Cartão de Crédito</button>
                                    <button type="button" data-source="account" class="toggle-btn py-3 px-2 rounded-md border-2 border-[var(--cor-borda)]">Débito</button>
                                </div>
                            </div>
                
                            <div id="new-credit-card-options" class="space-y-6 hidden">
                                <div>
                                    <label class="text-sm font-medium text-[var(--cor-texto-secundario)]">Condição de pagamento</label>
                                    <div id="new-payment-condition" class="mt-2 grid grid-cols-2 gap-2 text-sm">
                                        <button type="button" data-condition="single" class="toggle-btn py-3 px-2 rounded-md border-2 border-[var(--cor-borda)]">À vista</button>
                                        <button type="button" data-condition="installments" class="toggle-btn py-3 px-2 rounded-md border-2 border-[var(--cor-borda)]">Parcelado</button>
                                    </div>
                                </div>
                
                                <div id="new-installments-section" class="hidden">
                                     <label for="new-installments-count" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Quantidade de Parcelas</label>
                                     <input type="number" id="new-installments-count" class="mt-1 appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md" placeholder="Ex: 12">
                                </div>
                            </div>
                        </div>
                
                        <div>
                             <label id="new-account-label" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Conta</label>
                             <a href="#" class="flex items-center justify-between p-4 bg-[var(--fundo-elemento)] rounded-lg w-full text-left hover:bg-white/10 transition-colors" onclick="showScreen(20)">
                                <div id="new-account-selector" class="flex items-center">
                                    <i id="new-account-icon" data-lucide="landmark" class="w-5 h-5 text-[var(--cor-acento-dourado)] mr-3"></i>
                                    <span id="new-account-name">Conta Corrente</span>
                                </div>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                            </a>
                        </div>
                    </form>
                </main>
                <footer class="p-4">
                    <button id="save-new-transaction-btn" class="w-full py-3 text-sm font-bold rounded-md text-black bg-[var(--cor-acento-dourado)] hover:bg-[var(--cor-acento-dourado-hover)] transition-colors duration-300">Registrar</button>
                </footer>
            </div>
            
            <div id="screen-6" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                   <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(2)"></i>
                   <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]" id="detail-title">Detalhe da Transação</h1>
                   <div class="w-6"></div>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content pb-24 space-y-4">
                    <div class="text-center py-4">
                        <p class="text-4xl font-bold" id="detail-value"></p>
                        <p class="font-semibold text-[var(--cor-texto-principal)]" id="detail-name"></p>
                    </div>
                    <div class="bg-[var(--fundo-elemento)] p-4 rounded-lg space-y-3">
                        <div class="flex justify-between text-sm">
                            <span class="text-[var(--cor-texto-secundario)]">Categoria</span>
                            <span class="font-medium" id="detail-category"></span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-[var(--cor-texto-secundario)]">Data</span>
                            <span class="font-medium" id="detail-date"></span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-[var(--cor-texto-secundario)]">Conta</span>
                            <span class="font-medium" id="detail-account"></span>
                        </div>
                        <div>
                            <span class="text-sm text-[var(--cor-texto-secundario)]">Descrição</span>
                            <p class="text-sm font-medium mt-1" id="detail-description"></p>
                        </div>
                    </div>
                </main>
                <footer class="absolute bottom-0 left-0 right-0 p-4">
                    <div class="flex space-x-4">
                        <button id="edit-transaction-btn" class="w-full py-3 text-sm font-bold rounded-md text-[var(--cor-texto-principal)] bg-[var(--fundo-elemento)] hover:opacity-80">Editar</button>
                        <button id="delete-transaction-btn" class="w-full py-3 text-sm font-bold rounded-md text-white bg-[var(--cor-despesa)] hover:opacity-80">Excluir</button>
                    </div>
                </footer>
            </div>

            <div id="screen-7" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                   <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(1)"></i>
                   <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Perfil</h1>
                   <div class="w-6"></div>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content pb-24 flex flex-col items-center">
                    <div class="relative mt-8 mb-4">
                        <img class="w-24 h-24 rounded-full border-4 border-[var(--cor-acento-dourado)]" src="https://placehold.co/100x100/0a2b52/C4A35A?text=U" alt="Avatar do usuário">
                        <button class="absolute bottom-0 right-0 bg-[var(--cor-acento-dourado)] text-black w-7 h-7 rounded-full flex items-center justify-center shadow-md">
                            <i data-lucide="camera" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <p class="text-xl font-bold">Usuário</p>
                    <p class="text-sm text-[var(--cor-texto-secundario)] mb-8">usuario@email.com</p>
                    
                    <div class="w-full space-y-2">
                        <a href="#" class="flex items-center justify-between p-4 bg-[var(--fundo-elemento)] rounded-lg w-full text-left hover:bg-white/10 transition-colors" onclick="showScreen(11)">
                            <span class="flex items-center"><i data-lucide="user" class="w-5 h-5 mr-3 text-[var(--cor-acento-dourado)]"></i>Editar Perfil</span>
                            <i data-lucide="chevron-right" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                        </a>
                        <a href="#" class="flex items-center justify-between p-4 bg-[var(--fundo-elemento)] rounded-lg w-full text-left hover:bg-white/10 transition-colors" onclick="showScreen(10)">
                            <span class="flex items-center"><i data-lucide="settings" class="w-5 h-5 mr-3 text-[var(--cor-acento-dourado)]"></i>Configurações</span>
                            <i data-lucide="chevron-right" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                        </a>
                        <a href="#" class="flex items-center justify-between p-4 bg-[var(--fundo-elemento)] rounded-lg w-full text-left hover:bg-white/10 transition-colors" onclick="showScreen(12)">
                            <span class="flex items-center"><i data-lucide="shield" class="w-5 h-5 mr-3 text-[var(--cor-acento-dourado)]"></i>Segurança</span>
                            <i data-lucide="chevron-right" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                        </a>
                        <a href="#" onclick="showScreen(0)" class="flex items-center justify-between p-4 bg-[var(--fundo-elemento)] rounded-lg w-full text-left hover:bg-white/10 transition-colors">
                            <span class="flex items-center"><i data-lucide="log-out" class="w-5 h-5 mr-3 text-[var(--cor-despesa)]"></i>Sair</span>
                        </a>
                    </div>
                </main>
            </div>

            <div id="screen-8" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]"><h1 class="text-xl font-bold text-[var(--cor-texto-principal)]">Metas</h1></header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content pb-24 space-y-4">
                    <div class="goal-card bg-[var(--fundo-elemento)] p-4 rounded-lg cursor-pointer hover:bg-white/10 transition-colors" onclick="showScreen(4)">
                        <div class="flex items-center mb-3">
                            <div class="w-10 h-10 flex items-center justify-center rounded-full bg-[var(--fundo-principal)] mr-3"><i data-lucide="utensils" class="w-5 h-5 text-[var(--cor-alimentacao)]"></i></div>
                            <p class="font-semibold text-[var(--cor-texto-principal)]">Bares e Restaurantes</p>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2.5 mb-1"><div class="bg-[var(--cor-alimentacao)] h-2.5 rounded-full" style="width: 9%"></div></div>
                        <p class="text-xs text-[var(--cor-texto-secundario)] text-right">R$ 9,00 de R$ 100,00</p>
                    </div>
                    <div class="goal-card bg-[var(--fundo-elemento)] p-4 rounded-lg cursor-pointer hover:bg-white/10 transition-colors">
                        <div class="flex items-center mb-3">
                            <div class="w-10 h-10 flex items-center justify-center rounded-full bg-[var(--fundo-principal)] mr-3"><i data-lucide="plane" class="w-5 h-5 text-[var(--cor-viagem)]"></i></div>
                            <p class="font-semibold text-[var(--cor-texto-principal)]">Viagem de Férias</p>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2.5 mb-1"><div class="bg-[var(--cor-viagem)] h-2.5 rounded-full" style="width: 75%"></div></div>
                        <p class="text-xs text-[var(--cor-texto-secundario)] text-right">R$ 3.750,00 de R$ 5.000,00</p>
                    </div>
                </main>
            </div>
            
             <div id="screen-9" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                   <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(1)"></i>
                   <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Notificações</h1>
                   <div class="w-6"></div>
                </header>
                <main class="flex-1 overflow-y-auto mobile-screen-content">
                    <div class="p-4 space-y-4">
                        <div class="flex items-start space-x-3 bg-[var(--fundo-elemento)] p-3 rounded-lg">
                            <div class="w-10 h-10 flex items-center justify-center rounded-full bg-[var(--cor-despesa)]/20 text-[var(--cor-despesa)]"><i data-lucide="calendar-clock"></i></div>
                            <div>
                                <p class="font-semibold">Lembrete de Pagamento</p>
                                <p class="text-sm text-[var(--cor-texto-secundario)]">Sua conta de Aluguel no valor de R$ 1.500,00 vence amanhã.</p>
                                <p class="text-xs text-gray-500 mt-1">Hoje, 09:30</p>
                            </div>
                        </div>
                         <div class="flex items-start space-x-3 bg-[var(--fundo-elemento)] p-3 rounded-lg">
                            <div class="w-10 h-10 flex items-center justify-center rounded-full bg-[var(--cor-viagem)]/20 text-[var(--cor-viagem)]"><i data-lucide="target"></i></div>
                            <div>
                                <p class="font-semibold">Meta Quase Atingida!</p>
                                <p class="text-sm text-[var(--cor-texto-secundario)]">Você já alcançou 75% da sua meta "Viagem de Férias". Continue assim!</p>
                                <p class="text-xs text-gray-500 mt-1">Ontem, 18:45</p>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

            <div id="screen-10" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                   <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(7)"></i>
                   <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Configurações</h1>
                   <div class="w-6"></div>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content space-y-4">
                    <div>
                        <h3 class="text-sm font-semibold text-[var(--cor-texto-secundario)] px-4 mb-2">APARÊNCIA</h3>
                        <div class="bg-[var(--fundo-elemento)] p-4 rounded-lg">
                             <div class="flex justify-between items-center">
                                <span class="font-medium">Tema</span>
                                <div class="flex items-center gap-2 bg-[var(--fundo-principal)] p-1 rounded-full">
                                    <button class="theme-btn selected px-3 py-1 rounded-full text-sm" style="--cor-selecionada: var(--cor-acento-dourado);">Escuro</button>
                                    <button class="theme-btn px-3 py-1 rounded-full text-sm">Claro</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-sm font-semibold text-[var(--cor-texto-secundario)] px-4 mb-2">GERAL</h3>
                        <div class="bg-[var(--fundo-elemento)] rounded-lg divide-y divide-[var(--cor-borda)]">
                            <a href="#" class="flex items-center justify-between p-4 w-full text-left hover:bg-white/10 transition-colors" onclick="showScreen(9)">
                                <span>Notificações</span>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                            </a>
                            <a href="#" class="flex items-center justify-between p-4 w-full text-left hover:bg-white/10 transition-colors">
                                <span>Contas Conectadas</span>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                            </a>
                            <a href="#" class="flex items-center justify-between p-4 w-full text-left hover:bg-white/10 transition-colors">
                                <span>Ajuda e Suporte</span>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                            </a>
                        </div>
                    </div>
                </main>
            </div>

            <div id="screen-11" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                   <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(7)"></i>
                   <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Editar Perfil</h1>
                   <button class="font-semibold text-[var(--cor-acento-dourado)] hover:opacity-80 transition-opacity">Salvar</button>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content space-y-4">
                     <div class="flex flex-col items-center mt-4">
                        <div class="relative mb-4">
                            <img class="w-24 h-24 rounded-full border-4 border-[var(--cor-acento-dourado)]" src="https://placehold.co/100x100/0a2b52/C4A35A?text=U" alt="Avatar do usuário">
                            <button class="absolute bottom-0 right-0 bg-[var(--cor-acento-dourado)] text-black w-7 h-7 rounded-full flex items-center justify-center shadow-md">
                                <i data-lucide="camera" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                    <form class="space-y-4">
                          <div>
                            <label for="profile-name" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Nome</label>
                            <input type="text" id="profile-name" value="Usuário" class="mt-1 appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md focus:outline-none focus:ring-[var(--cor-acento-dourado)] focus:border-[var(--cor-acento-dourado)] sm:text-sm">
                        </div>
                          <div>
                            <label for="profile-email" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Email</label>
                            <input type="email" id="profile-email" value="usuario@email.com" class="mt-1 appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md focus:outline-none focus:ring-[var(--cor-acento-dourado)] focus:border-[var(--cor-acento-dourado)] sm:text-sm">
                        </div>
                    </form>
                </main>
            </div>

            <div id="screen-12" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                   <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(7)"></i>
                   <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Segurança</h1>
                   <div class="w-6"></div>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content">
                    <div class="bg-[var(--fundo-elemento)] rounded-lg divide-y divide-[var(--cor-borda)]">
                        <a href="#" class="flex items-center justify-between p-4 w-full text-left hover:bg-white/10 transition-colors">
                            <span>Alterar Senha</span>
                            <i data-lucide="chevron-right" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                        </a>
                        <div class="flex items-center justify-between p-4 w-full text-left">
                            <span>Autenticação de 2 Fatores</span>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" id="security-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                <label for="security-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
            
            <div id="screen-13" class="screen hidden w-full h-full flex flex-col">
                <div class="p-4 text-center">Tela de Edição (a ser implementada com o novo layout)</div>
            </div>
            
            <div id="screen-14" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                   <i data-lucide="x" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(1)"></i>
                   <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Perfil Financeiro</h1>
                   <button id="skip-questionnaire-btn" class="font-semibold text-[var(--cor-texto-secundario)] hover:text-white transition-opacity">Pular</button>
                </header>
                <div class="w-full h-1 bg-[var(--fundo-card)]">
                    <div id="progress-bar" class="h-full bg-[var(--cor-acento-dourado)] transition-all duration-300"></div>
                </div>
                <main class="flex-1 p-6 flex flex-col justify-between">
                    <p id="question-text" class="text-center text-xl font-medium leading-relaxed"></p>
                    <div id="answer-options" class="space-y-3">
                        </div>
                    <button id="next-question-btn" class="w-full py-3 text-sm font-bold rounded-md text-black bg-[var(--cor-acento-dourado)] hover:bg-[var(--cor-acento-dourado-hover)] transition-opacity duration-300 disabled:opacity-50" disabled>Próximo</button>
                </main>
            </div>
            
            <div id="screen-15" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                   <i data-lucide="x" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(1)"></i>
                   <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Resultado do Perfil</h1>
                   <div class="w-6"></div>
                </header>
                <main class="flex-1 p-6 overflow-y-auto mobile-screen-content space-y-6">
                    <div id="profile-result-summary" class="text-center">
                        <i data-lucide="award" class="w-16 h-16 mx-auto text-[var(--cor-acento-dourado)]"></i>
                        <h2 id="profile-result-title" class="text-2xl font-bold mt-4"></h2>
                        <p id="profile-result-description" class="text-[var(--cor-texto-secundario)] mt-2"></p>
                    </div>
                    
                    <div id="profile-scores" class="bg-[var(--fundo-elemento)] p-4 rounded-lg space-y-3">
                        <h3 class="text-md font-semibold text-center mb-3">Sua Pontuação</h3>
                        <!-- Scores will be populated here by JS -->
                    </div>
                    
                    <div class="pt-6 border-t border-[var(--cor-borda)]">
                        <h3 class="text-xl font-bold text-center mb-4">Evolua sua jornada financeira</h3>
                        <button class="w-full py-3 text-sm font-bold rounded-md text-black bg-[var(--cor-acento-dourado)] hover:bg-[var(--cor-acento-dourado-hover)]" onclick="showScreen(16)">Ver Nossos Planos</button>
                    </div>
                    <footer class="text-center">
                        <button class="w-full py-3 text-sm font-bold rounded-md text-[var(--cor-texto-secundario)] hover:text-white" onclick="showScreen(1)">Voltar ao Dashboard</button>
                    </footer>
                </main>
            </div>
            
             <div id="screen-16" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                   <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(1)"></i>
                   <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Nossos Planos</h1>
                   <div class="w-6"></div>
                </header>
                <main class="flex-1 p-6 overflow-y-auto mobile-screen-content space-y-6">
                    <div class="space-y-4">
                        <div class="bg-[var(--fundo-elemento)] p-4 rounded-lg border-2 border-transparent hover:border-[var(--cor-acento-dourado)] transition-colors">
                            <h4 class="font-bold text-lg">Plano Essencial</h4>
                            <p class="text-2xl font-bold my-2">R$ 19,90<span class="text-sm font-normal text-[var(--cor-texto-secundario)]">/mês</span></p>
                            <ul class="text-sm space-y-1 text-[var(--cor-texto-secundario)] mb-4">
                                <li class="flex items-center"><i data-lucide="check" class="w-4 h-4 mr-2 text-[var(--cor-receita)]"></i>Controle de gastos completo</li>
                                <li class="flex items-center"><i data-lucide="check" class="w-4 h-4 mr-2 text-[var(--cor-receita)]"></i>Criação de metas</li>
                            </ul>
                            <button class="w-full py-2 text-sm font-bold rounded-md bg-[var(--fundo-principal)] hover:bg-opacity-80">Selecionar</button>
                        </div>
                        <div class="bg-[var(--fundo-elemento)] p-4 rounded-lg border-2 border-[var(--cor-acento-dourado)] relative">
                             <span class="absolute top-0 right-4 -mt-3 bg-[var(--cor-acento-dourado)] text-black text-xs font-bold px-2 py-1 rounded-full">MAIS POPULAR</span>
                            <h4 class="font-bold text-lg">Plano Premium</h4>
                            <p class="text-2xl font-bold my-2">R$ 39,90<span class="text-sm font-normal text-[var(--cor-texto-secundario)]">/mês</span></p>
                            <ul class="text-sm space-y-1 text-[var(--cor-texto-secundario)] mb-4">
                                <li class="flex items-center"><i data-lucide="check" class="w-4 h-4 mr-2 text-[var(--cor-receita)]"></i>Tudo do Plano Essencial</li>
                                <li class="flex items-center"><i data-lucide="check" class="w-4 h-4 mr-2 text-[var(--cor-receita)]"></i>Relatórios detalhados</li>
                                <li class="flex items-center"><i data-lucide="check" class="w-4 h-4 mr-2 text-[var(--cor-receita)]"></i>Consultoria com especialista</li>
                            </ul>
                            <button class="w-full py-2 text-sm font-bold rounded-md text-black bg-[var(--cor-acento-dourado)] hover:bg-[var(--cor-acento-dourado-hover)]">Selecionar</button>
                        </div>
                         <div class="bg-[var(--fundo-elemento)] p-4 rounded-lg border-2 border-transparent hover:border-[var(--cor-acento-dourado)] transition-colors">
                            <h4 class="font-bold text-lg">Plano Castelo Forte</h4>
                            <p class="text-2xl font-bold my-2">R$ 59,90<span class="text-sm font-normal text-[var(--cor-texto-secundario)]">/mês</span></p>
                            <ul class="text-sm space-y-1 text-[var(--cor-texto-secundario)] mb-4">
                                <li class="flex items-center"><i data-lucide="check" class="w-4 h-4 mr-2 text-[var(--cor-receita)]"></i>Tudo do Plano Premium</li>
                                <li class="flex items-center"><i data-lucide="check" class="w-4 h-4 mr-2 text-[var(--cor-receita)]"></i>Acesso a carteiras recomendadas</li>
                                <li class="flex items-center"><i data-lucide="check" class="w-4 h-4 mr-2 text-[var(--cor-receita)]"></i>Gerente de conta pessoal</li>
                            </ul>
                            <button class="w-full py-2 text-sm font-bold rounded-md bg-[var(--fundo-principal)] hover:bg-opacity-80">Selecionar</button>
                        </div>
                    </div>
                </main>
            </div>

            <div id="screen-17" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                    <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(1)"></i>
                    <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Detalhes do Cartão</h1>
                    <div class="w-6"></div>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content space-y-6">
                    <div class="w-full h-52 mx-auto p-6 rounded-2xl bg-gradient-to-br from-gray-700 to-gray-900 flex flex-col justify-between shadow-lg">
                        <div>
                            <div class="flex justify-between items-start">
                                <span class="text-white font-bold text-xl">Castelo Bank</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16" viewBox="0 0 24 24"><circle cx="10" cy="12" r="7" fill="#EA001B"/><circle cx="14" cy="12" r="7" fill="#F79E1B" fill-opacity=".8"/></svg>
                            </div>
                        </div>
                        <div>
                            <p class="text-white font-mono tracking-widest text-2xl mb-2">**** **** **** 1234</p>
                            <div class="flex justify-between text-sm">
                                <p class="text-gray-300">Usuário</p>
                                <p class="text-gray-300">12/29</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-[var(--fundo-elemento)] p-4 rounded-lg grid grid-cols-2 gap-4 text-center">
                        <div>
                           <p class="text-sm text-[var(--cor-texto-secundario)]">Fechamento</p>
                           <p class="text-lg font-bold text-[var(--cor-texto-principal)]">Dia 28</p>
                        </div>
                         <div>
                           <p class="text-sm text-[var(--cor-texto-secundario)]">Vencimento</p>
                           <p class="text-lg font-bold text-[var(--cor-texto-principal)]">Dia 05</p>
                        </div>
                    </div>

                    <div class="bg-[var(--fundo-elemento)] p-4 rounded-lg text-center">
                        <p class="text-sm text-[var(--cor-texto-secundario)]">Limite Disponível</p>
                        <p class="text-2xl font-bold text-[var(--cor-receita)]">R$ 4.145,70</p>
                    </div>

                    <div class="bg-[var(--fundo-elemento)] p-4 rounded-lg">
                        <div class="pb-3">
                            <div class="flex justify-between items-center text-center mb-2">
                                <i id="prev-bill-btn" data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer p-1 rounded-full hover:bg-white/10"></i>
                                <div class="flex-1">
                                    <p id="bill-month-year" class="text-lg font-semibold text-[var(--cor-texto-principal)]"></p>
                                    <p id="bill-status" class="text-xs font-semibold"></p>
                                </div>
                                <i id="next-bill-btn" data-lucide="chevron-right" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer p-1 rounded-full hover:bg-white/10"></i>
                            </div>
                            <div class="flex justify-between items-end mt-2">
                                <div>
                                    <p class="text-sm text-[var(--cor-texto-secundario)]">Valor da Fatura</p>
                                    <p id="bill-value" class="text-2xl font-bold"></p>
                                </div>
                                <button id="bill-action-btn" class="text-sm font-semibold text-[var(--cor-acento-dourado)]"></button>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-md font-semibold text-[var(--cor-texto-principal)] mb-2">Últimos Lançamentos</h3>
                        <div class="space-y-2">
                             <div class="bg-[var(--fundo-elemento)] p-3 rounded-lg flex justify-between items-center">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 flex items-center justify-center rounded-full bg-[var(--fundo-principal)] mr-3"><i data-lucide="shopping-cart" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i></div>
                                    <div><p class="font-semibold text-[var(--cor-texto-principal)]">Amazon.com.br</p><p class="text-xs text-[var(--cor-texto-secundario)]">07 de Julho</p></div>
                                </div>
                                <p class="font-bold text-[var(--cor-texto-principal)]">- R$ 129,90</p>
                            </div>
                             <div class="bg-[var(--fundo-elemento)] p-3 rounded-lg flex justify-between items-center">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 flex items-center justify-center rounded-full bg-[var(--fundo-principal)] mr-3"><i data-lucide="utensils" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i></div>
                                    <div><p class="font-semibold text-[var(--cor-texto-principal)]">iFood</p><p class="text-xs text-[var(--cor-texto-secundario)]">06 de Julho</p></div>
                                </div>
                                <p class="font-bold text-[var(--cor-texto-principal)]">- R$ 54,00</p>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

            <div id="screen-18" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                    <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(1)"></i>
                    <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Adicionar Cartão</h1>
                    <button class="font-semibold text-[var(--cor-acento-dourado)] hover:opacity-80 transition-opacity" onclick="showScreen(1)">Salvar</button>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content space-y-6">
                    <form class="space-y-4">
                        <div>
                            <label for="card-number" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Número do Cartão</label>
                            <input type="text" id="card-number" class="mt-1 appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md focus:outline-none focus:ring-[var(--cor-acento-dourado)] focus:border-[var(--cor-acento-dourado)] sm:text-sm" placeholder="**** **** **** ****">
                        </div>
                        <div>
                            <label for="card-holder" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Nome no Cartão</label>
                            <input type="text" id="card-holder" class="mt-1 appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md focus:outline-none focus:ring-[var(--cor-acento-dourado)] focus:border-[var(--cor-acento-dourado)] sm:text-sm" placeholder="Seu nome completo">
                        </div>
                        <div class="flex space-x-4">
                            <div class="w-1/2">
                                <label for="card-expiry" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Validade</label>
                                <input type="text" id="card-expiry" class="mt-1 appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md focus:outline-none focus:ring-[var(--cor-acento-dourado)] focus:border-[var(--cor-acento-dourado)] sm:text-sm" placeholder="MM/AA">
                            </div>
                            <div class="w-1/2">
                                <label for="card-cvv" class="text-sm font-medium text-[var(--cor-texto-secundario)]">CVV</label>
                                <input type="text" id="card-cvv" class="mt-1 appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md focus:outline-none focus:ring-[var(--cor-acento-dourado)] focus:border-[var(--cor-acento-dourado)] sm:text-sm" placeholder="***">
                            </div>
                        </div>
                         <div class="flex space-x-4">
                            <div class="w-1/2">
                                <label for="card-close-day" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Dia do Fechamento</label>
                                <input type="number" id="card-close-day" class="mt-1 appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md" placeholder="Ex: 28">
                            </div>
                            <div class="w-1/2">
                                <label for="card-due-day" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Dia do Vencimento</label>
                                <input type="number" id="card-due-day" class="mt-1 appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md" placeholder="Ex: 05">
                            </div>
                        </div>
                         <div>
                            <label for="card-nickname" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Apelido do Cartão (Opcional)</label>
                            <input type="text" id="card-nickname" class="mt-1 appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md focus:outline-none focus:ring-[var(--cor-acento-dourado)] focus:border-[var(--cor-acento-dourado)] sm:text-sm" placeholder="Ex: Cartão Principal">
                        </div>
                    </form>
                </main>
            </div>

            <div id="screen-19" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                    <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(5)"></i>
                    <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Selecionar Categoria</h1>
                    <div class="w-6"></div>
                </header>
                <main id="category-list-container" class="flex-1 p-4 overflow-y-auto mobile-screen-content space-y-2"></main>
            </div>
            
            <div id="screen-20" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                    <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(5)"></i>
                    <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Selecionar Conta/Cartão</h1>
                    <div class="w-6"></div>
                </header>
                <main id="account-list-container" class="flex-1 p-4 overflow-y-auto mobile-screen-content space-y-2"></main>
            </div>

            <div id="screen-21" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                    <i data-lucide="x" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(2)"></i>
                    <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Filtrar Lançamentos</h1>
                    <button id="reset-filters-btn" class="font-semibold text-[var(--cor-acento-dourado)] hover:opacity-80 transition-opacity">Limpar</button>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content space-y-6">
                    <div id="filter-section-type">
                        <h3 class="text-md font-semibold text-[var(--cor-texto-principal)] mb-3">Tipo</h3>
                        <div id="filter-type-options" class="flex flex-wrap gap-2">
                            <button class="filter-chip-btn py-2 px-4 rounded-full border-2 border-[var(--cor-borda)] text-sm" data-filter-group="type" data-filter-value="income">Receitas</button>
                            <button class="filter-chip-btn py-2 px-4 rounded-full border-2 border-[var(--cor-borda)] text-sm" data-filter-group="type" data-filter-value="expense">Despesas</button>
                            <button class="filter-chip-btn py-2 px-4 rounded-full border-2 border-[var(--cor-borda)] text-sm" data-filter-group="type" data-filter-value="transfer">Transferências</button>
                        </div>
                    </div>
                     <div id="filter-section-status">
                        <h3 class="text-md font-semibold text-[var(--cor-texto-principal)] mb-3">Situação</h3>
                        <div id="filter-status-options" class="flex flex-wrap gap-2">
                            <button class="filter-chip-btn py-2 px-4 rounded-full border-2 border-[var(--cor-borda)] text-sm" data-filter-group="status" data-filter-value="pago">Resolvido</button>
                            <button class="filter-chip-btn py-2 px-4 rounded-full border-2 border-[var(--cor-borda)] text-sm" data-filter-group="status" data-filter-value="pendente">Pendente</button>
                        </div>
                    </div>
                    <div id="filter-section-accounts">
                        <h3 class="text-md font-semibold text-[var(--cor-texto-principal)] mb-3">Contas</h3>
                        <div id="filter-account-options" class="flex flex-wrap gap-2">
                             <!-- Populated by JS -->
                        </div>
                    </div>
                     <div id="filter-section-cards">
                        <h3 class="text-md font-semibold text-[var(--cor-texto-principal)] mb-3">Cartões</h3>
                        <div id="filter-card-options" class="flex flex-wrap gap-2">
                             <!-- Populated by JS -->
                        </div>
                    </div>
                    <div id="filter-section-categories">
                        <h3 class="text-md font-semibold text-[var(--cor-texto-principal)] mb-3">Categorias</h3>
                        <div id="filter-category-options" class="flex flex-wrap gap-2">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </main>
                <footer class="p-4">
                    <button id="apply-filters-btn" class="w-full py-3 text-sm font-bold rounded-md text-black bg-[var(--cor-acento-dourado)] hover:bg-[var(--cor-acento-dourado-hover)] transition-colors duration-300">Aplicar Filtros</button>
                </footer>
            </div>
            
            <div id="screen-22" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                    <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(5)"></i>
                    <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Selecionar Meta</h1>
                    <div class="w-6"></div>
                </header>
                <main id="goal-list-container" class="flex-1 p-4 overflow-y-auto mobile-screen-content space-y-2"></main>
            </div>

            <div id="screen-23" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                    <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(1)"></i>
                    <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Minhas Contas</h1>
                    <i data-lucide="plus-circle" class="w-6 h-6 text-[var(--cor-acento-dourado)] cursor-pointer" onclick="showScreen(25)"></i>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content space-y-4">
                    <div id="all-accounts-list" class="space-y-3">
                        <!-- Populated by JS -->
                    </div>
                </main>
            </div>

            <div id="screen-24" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                    <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(1)"></i>
                    <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Meus Cartões</h1>
                    <i data-lucide="plus-circle" class="w-6 h-6 text-[var(--cor-acento-dourado)] cursor-pointer" onclick="showScreen(18)"></i>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content space-y-4">
                    <div id="all-cards-list" class="space-y-4">
                        <!-- Populated by JS -->
                    </div>
                </main>
            </div>

            <div id="screen-25" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                    <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(23)"></i>
                    <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Adicionar Conta</h1>
                    <button class="font-semibold text-[var(--cor-acento-dourado)] hover:opacity-80 transition-opacity" onclick="showScreen(23)">Salvar</button>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content space-y-6">
                    <form class="space-y-4">
                        <div>
                            <label for="account-bank" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Instituição Financeira</label>
                            <input type="text" id="account-bank" class="mt-1 appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md" placeholder="Ex: Banco do Brasil">
                        </div>
                        <div>
                            <label for="account-nickname" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Apelido da Conta</label>
                            <input type="text" id="account-nickname" class="mt-1 appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md" placeholder="Ex: Conta Salário">
                        </div>
                        <div>
                            <label for="account-balance" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Saldo Inicial</label>
                            <input type="text" id="account-balance" class="mt-1 appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md" placeholder="R$ 0,00">
                        </div>
                    </form>
                </main>
            </div>

            <!-- NEW SCREEN: Account Details -->
            <div id="screen-26" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                    <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(23)"></i>
                    <h1 id="account-detail-name" class="text-lg font-semibold text-[var(--cor-texto-principal)]">Detalhes da Conta</h1>
                    <i data-lucide="settings-2" class="w-5 h-5 text-[var(--cor-texto-secundario)] cursor-pointer"></i>
                </header>
                <main class="flex-1 overflow-y-auto mobile-screen-content">
                    <div class="p-4 text-center bg-[var(--fundo-card)]">
                        <p class="text-sm text-[var(--cor-texto-secundario)]">Saldo Atual</p>
                        <p id="account-detail-balance" class="text-3xl font-bold text-[var(--cor-acento-dourado)] mt-1"></p>
                    </div>
                    <div class="p-4">
                        <h3 class="text-md font-semibold text-[var(--cor-texto-principal)] mb-2">Últimos Lançamentos</h3>
                        <div id="account-detail-transaction-list" class="space-y-1">
                            <!-- Transactions for this account will be rendered here -->
                        </div>
                    </div>
                </main>
            </div>

            <div id="confirmation-modal" class="hidden absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                <div class="bg-[var(--fundo-card)] p-6 rounded-xl shadow-lg w-full max-w-xs text-center">
                    <p id="modal-message" class="mb-6">Tem certeza que deseja excluir este item?</p>
                    <div class="flex space-x-4">
                        <button id="modal-cancel-btn" class="w-full py-2 text-sm font-bold rounded-md text-[var(--cor-texto-principal)] bg-[var(--fundo-elemento)] hover:opacity-80">Cancelar</button>
                        <button id="modal-confirm-btn" class="w-full py-2 text-sm font-bold rounded-md text-white bg-[var(--cor-despesa)] hover:opacity-80">Excluir</button>
                    </div>
                </div>
            </div>


            <nav class="absolute bottom-0 left-0 right-0 h-20 bg-black/20 backdrop-blur-lg border-t border-[var(--cor-borda)]">
                <div class="relative flex justify-around items-center h-full">
                    <a href="#" class="nav-link flex flex-col items-center justify-center h-full text-[var(--cor-texto-secundario)] w-1/5" data-screen="1"><i data-lucide="layout-dashboard" class="w-6 h-6"></i><span class="text-[10px] mt-1">Dashboard</span></a>
                    <a href="#" class="nav-link flex flex-col items-center justify-center h-full text-[var(--cor-texto-secundario)] w-1/5" data-screen="2"><i data-lucide="arrow-right-left" class="w-6 h-6"></i><span class="text-[10px] mt-1">Lançamentos</span></a>
                    <a href="#" class="nav-link flex flex-col items-center justify-center h-full text-[var(--cor-texto-secundario)] w-1/5" data-screen="2"><i data-lucide="arrow-right-left" class="w-6 h-6"></i></a>
                    <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2">
                        <a href="#" class="nav-link" data-screen="5">
                            <div class="bg-[var(--cor-acento-dourado)] text-[var(--fundo-principal)] w-12 h-12 rounded-2xl flex items-center justify-center shadow-lg hover:bg-[var(--cor-acento-dourado-hover)] transition-colors">
                               <i data-lucide="plus" class="w-6 h-6"></i>
                            </div>
                        </a>
                    </div>
                    <a href="#" class="nav-link flex flex-col items-center justify-center h-full text-[var(--cor-texto-secundario)] w-1/5" data-screen="3"><i data-lucide="pie-chart" class="w-6 h-6"></i><span class="text-[10px] mt-1">Relatórios</span></a>
                    <a href="#" class="nav-link flex flex-col items-center justify-center h-full text-[var(--cor-texto-secundario)] w-1/5" data-screen="8"><i data-lucide="target" class="w-6 h-6"></i><span class="text-[10px] mt-1">Metas</span></a>
                </div>
            </nav>
            
            <div class="fixed top-4 right-4 flex flex-col space-y-3 z-50">
                <button id="next-screen-btn" class="bg-[var(--cor-acento-dourado)] text-[var(--fundo-principal)] p-3 rounded-full shadow-lg hover:bg-[var(--cor-acento-dourado-hover)] transition-opacity">
                    <i data-lucide="arrow-right-circle"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            let currentScreenIndex = 0;
            const navLinks = document.querySelectorAll('.nav-link');
            let barChartInstance, pieChartInstance, dashboardPieChartInstance;
            const months = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
            let currentDate = new Date(2025, 6, 1);
            let activeTransactionView = 'todos'; // 'contas', 'cartoes', 'todos'
            
            const goals = [
                { name: 'Bares e Restaurantes', icon: 'utensils' },
                { name: 'Viagem de Férias', icon: 'plane' }
            ];

            const expenseCategoriesWithIcons = [
                { name: 'Metas', icon: 'target' },
                { name: 'Moradia', icon: 'home' }, 
                { name: 'Alimentação', icon: 'shopping-cart' },
                { name: 'Transporte', icon: 'car' }, 
                { name: 'Lazer', icon: 'gamepad-2' },
                { name: 'Saúde', icon: 'heart-pulse' }, 
                { name: 'Educação', icon: 'book-open' },
                { name: 'Outras Despesas', icon: 'tag' }
            ];
            const incomeCategoriesWithIcons = [
                { name: 'Salário', icon: 'briefcase' }, 
                { name: 'Vendas', icon: 'dollar-sign' },
                { name: 'Investimentos', icon: 'trending-up' }, 
                { name: 'Outras Receitas', icon: 'gift' }
            ];
            const accountsAndCards = [
                { name: 'Conta Corrente', type: 'account', icon: 'landmark', bank: 'Nubank', balance: 'R$ 8.540,20' },
                { name: 'Conta Poupança', type: 'account', icon: 'piggy-bank', bank: 'Banco do Brasil', balance: 'R$ 3.910,55' },
                { name: 'Castelo Bank Final 1234', type: 'card', icon: 'credit-card', flag: 'mastercard' },
                { name: 'Outro Cartão Final 5678', type: 'card', icon: 'credit-card', flag: 'visa' }
            ];
            let currentTransactionToEdit = null;

            const sampleBills = [
                { month: 5, year: 2025, value: 1250.50, status: 'PAGA', statusColor: 'text-green-400', valueColor: '--cor-texto-secundario', actionText: 'Comprovante' },
                { month: 6, year: 2025, value: 854.30, status: 'FECHADA', statusColor: 'text-[var(--cor-acento-dourado)]', valueColor: '--cor-acento-dourado', actionText: 'Pagar Fatura' },
                { month: 7, year: 2025, value: 150.25, status: 'ABERTA', statusColor: 'text-sky-400', valueColor: '--cor-texto-principal', actionText: 'Ver Parcial' },
                { month: 8, year: 2025, value: 0.00, status: 'FUTURA', statusColor: 'text-gray-500', valueColor: '--cor-texto-principal', actionText: '' }
            ];
            let currentBillIndex = 1;

            const getCssVar = (name) => getComputedStyle(document.documentElement).getPropertyValue(name).trim();

            function updateNav(activeIndex) {
                navLinks.forEach(link => {
                    const screen = link.getAttribute('data-screen');
                    if (!screen) return; // Skip the central add button
                    const icon = link.querySelector('i');
                    const text = link.querySelector('span');
                    const isActive = screen == activeIndex;
                    
                    link.style.color = isActive ? getCssVar('--cor-acento-dourado') : getCssVar('--cor-texto-secundario');
                    if(text) text.classList.toggle('font-semibold', isActive);
                });
            }

            function updateAllMonthDisplays() {
                const displayMonth = months[currentDate.getMonth()];
                const displayYear = currentDate.getFullYear();
                const prevMonth = months[(currentDate.getMonth() - 1 + 12) % 12];
                const nextMonth = months[(currentDate.getMonth() + 1) % 12];

                document.querySelectorAll('.year-display').forEach(el => el.innerText = displayYear);
                document.querySelectorAll('.month-display').forEach(el => el.innerText = displayMonth);
                document.querySelectorAll('.prev-month-text').forEach(el => el.innerText = prevMonth);
                document.querySelectorAll('.next-month-text').forEach(el => el.innerText = nextMonth);
            }

            function updateBillDisplay() {
                const billData = sampleBills[currentBillIndex];
                const monthName = months[billData.month];
                document.getElementById('bill-month-year').innerText = `${monthName} ${billData.year}`;
                document.getElementById('bill-status').innerText = `FATURA ${billData.status}`;
                document.getElementById('bill-status').className = `text-xs font-semibold ${billData.statusColor}`;
                document.getElementById('bill-value').innerText = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(billData.value);
                document.getElementById('bill-value').style.color = getCssVar(billData.valueColor);
                const actionBtn = document.getElementById('bill-action-btn');
                actionBtn.innerText = billData.actionText;
                actionBtn.style.display = billData.actionText ? 'block' : 'none';
                document.getElementById('prev-bill-btn').style.visibility = currentBillIndex > 0 ? 'visible' : 'hidden';
                document.getElementById('next-bill-btn').style.visibility = currentBillIndex < sampleBills.length - 1 ? 'visible' : 'hidden';
            }

            function populateList(containerId, items, onSelect) {
                const container = document.getElementById(containerId);
                if (!container) return;
                container.innerHTML = '';
                items.forEach(item => {
                    const itemEl = document.createElement('a');
                    itemEl.href = '#';
                    itemEl.className = 'flex items-center p-4 bg-[var(--fundo-elemento)] rounded-lg hover:bg-white/10';
                    itemEl.addEventListener('click', (e) => {
                        e.preventDefault();
                        onSelect(item);
                    });
                    itemEl.innerHTML = `
                        <i data-lucide="${item.icon}" class="w-5 h-5 text-[var(--cor-acento-dourado)] mr-4"></i>
                        <span>${item.name}</span>
                    `;
                    container.appendChild(itemEl);
                });
                lucide.createIcons();
            }

            window.showScreen = (index, params = {}) => {
                document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
                const currentScreenEl = document.getElementById(`screen-${index}`);
                if(currentScreenEl) {
                    currentScreenEl.classList.remove('hidden');
                    currentScreenIndex = index;
                    const nav = document.querySelector('nav');
                    const screensWithoutNav = [0, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26];
                    nav.classList.toggle('hidden', screensWithoutNav.includes(index));
                    if ([1,2,3,8].includes(index)) { updateNav(index); }
                    if (index === 1) { setupDashboard(); }
                    if (index === 2) { renderTransactions(); }
                    if (index === 3) { createOrUpdateCharts(); }
                    if (index === 5) { setupTransactionForm('new', params.defaults); }
                    if (index === 17) { updateBillDisplay(); }
                    if (index === 19) {
                        const type = params.transactionType || 'expense';
                        const categories = type === 'income' ? incomeCategoriesWithIcons : expenseCategoriesWithIcons;
                        populateList('category-list-container', categories, (selectedCategory) => {
                            const selector = document.getElementById('new-category-selector');
                            if (selector) {
                                selector.innerHTML = `<i data-lucide="${selectedCategory.icon}" class="w-5 h-5 text-[var(--cor-acento-dourado)] mr-3"></i><span>${selectedCategory.name}</span>`;
                            }
                            const goalSection = document.getElementById('new-goal-selection-section');
                            if (goalSection) {
                                goalSection.classList.toggle('hidden', selectedCategory.name !== 'Metas');
                            }
                            lucide.createIcons();
                            showScreen(5, { defaults: params.defaults });
                        });
                    }
                    if (index === 20) {
                        populateList('account-list-container', accountsAndCards, (selectedAccount) => {
                            const selector = document.getElementById('new-account-selector');
                            const label = document.getElementById('new-account-label');
                            if(selector && label) {
                                selector.innerHTML = `<i data-lucide="${selectedAccount.icon}" class="w-5 h-5 text-[var(--cor-acento-dourado)] mr-3"></i><span>${selectedAccount.name}</span>`;
                                label.innerText = selectedAccount.type === 'card' ? 'Cartão' : 'Conta';
                                lucide.createIcons();
                            }
                            showScreen(5);
                        });
                    }
                    if (index === 21) {
                        setupFilterScreen();
                    }
                    if (index === 22) {
                        populateList('goal-list-container', goals, (selectedGoal) => {
                            const selector = document.getElementById('new-goal-selector');
                            if(selector) {
                                selector.innerHTML = `<i data-lucide="${selectedGoal.icon}" class="w-5 h-5 text-[var(--cor-acento-dourado)] mr-3"></i><span>${selectedGoal.name}</span>`;
                                lucide.createIcons();
                            }
                            showScreen(5);
                        });
                    }
                    if (index === 23) { populateAllAccountsScreen(); }
                    if (index === 24) { populateAllCardsScreen(); }
                    if (index === 26) { populateAccountDetailScreen(params.account); }
                }
            }
            
            function showTransactionDetail(element) {
                currentTransactionToEdit = element;
                const { title, value, category, date, account, description, type } = element.dataset;
                document.getElementById('detail-name').innerText = title;
                const valueEl = document.getElementById('detail-value');
                valueEl.innerText = value;
                document.getElementById('detail-category').innerText = category;
                document.getElementById('detail-date').innerText = date;
                document.getElementById('detail-account').innerText = account;
                document.getElementById('detail-description').innerText = description;
                const colorVar = type === 'income' ? '--cor-receita' : type === 'expense' ? '--cor-despesa' : '--cor-transferencia';
                valueEl.style.color = getCssVar(colorVar);
                showScreen(6);
            }
            
            function setupTransactionForm(prefix, defaults = {}) {
                const form = document.getElementById(`${prefix}-transaction-form`);
                if (!form) return;
                form.reset();

                const typeTabs = form.querySelectorAll('.transaction-type-tab-btn');
                const valueLabel = document.getElementById(`${prefix}-value-label`);
                const valueInput = document.getElementById(`${prefix}-transaction-value`);
                const nameInput = document.getElementById(`${prefix}-transaction-name`);
                const categorySelector = document.getElementById(`${prefix}-category-selector`);
                const goalSection = document.getElementById(`${prefix}-goal-selection-section`);
                const goalSelector = document.getElementById(`${prefix}-goal-selector`);
                const expenseOptions = document.getElementById(`${prefix}-expense-options`);
                const paymentSourceBtns = form.querySelectorAll(`#${prefix}-payment-source .toggle-btn`);
                const creditCardOptions = document.getElementById(`${prefix}-credit-card-options`);
                const paymentConditionBtns = form.querySelectorAll(`#${prefix}-payment-condition .toggle-btn`);
                const installmentsSection = document.getElementById(`${prefix}-installments-section`);
                const accountLabel = document.getElementById(`${prefix}-account-label`);
                const accountSelector = document.getElementById(`${prefix}-account-selector`);
                
                function updateButtonSelection(buttons, selectedBtn) {
                    buttons.forEach(btn => btn.classList.remove('selected'));
                    selectedBtn.classList.add('selected');
                }

                typeTabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        updateButtonSelection(typeTabs, tab);
                        const type = tab.dataset.type;
                        expenseOptions.classList.toggle('hidden', type !== 'expense');
                        document.getElementById('new-category-section').classList.toggle('hidden', type === 'transfer');
                        
                        if (type === 'expense') {
                            valueLabel.innerText = 'Valor da Despesa';
                            valueInput.style.color = getCssVar('--cor-despesa');
                        } else if (type === 'income') {
                            valueLabel.innerText = 'Valor da Receita';
                            valueInput.style.color = getCssVar('--cor-receita');
                        } else { // transfer
                            valueLabel.innerText = 'Valor da Transferência';
                            valueInput.style.color = getCssVar('--cor-transferencia');
                        }
                    });
                });

                paymentSourceBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        updateButtonSelection(paymentSourceBtns, btn);
                        const source = btn.dataset.source;
                        creditCardOptions.classList.toggle('hidden', source !== 'card');
                        if (source === 'card') {
                            paymentConditionBtns[0].click(); // Reset installments
                        }
                        installmentsSection.classList.add('hidden');
                        if (source === 'card') {
                            accountLabel.innerText = "Cartão";
                            accountSelector.innerHTML = `<i data-lucide="credit-card" class="w-5 h-5 text-[var(--cor-acento-dourado)] mr-3"></i><span>Castelo Bank Final 1234</span>`;
                        } else {
                            accountLabel.innerText = "Conta";
                            accountSelector.innerHTML = `<i data-lucide="landmark" class="w-5 h-5 text-[var(--cor-acento-dourado)] mr-3"></i><span>Conta Corrente</span>`;
                        }
                        lucide.createIcons();
                    });
                });

                paymentConditionBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        updateButtonSelection(paymentConditionBtns, btn);
                        installmentsSection.classList.toggle('hidden', btn.dataset.condition !== 'installments');
                    });
                });

                // Set defaults
                typeTabs[0].click();
                paymentSourceBtns[1].click();
                paymentConditionBtns[0].click();
                goalSection.classList.add('hidden');
                categorySelector.innerHTML = `<i data-lucide="shopping-cart" class="w-5 h-5 text-[var(--cor-acento-dourado)] mr-3"></i><span>Alimentação</span>`;
                goalSelector.innerHTML = `<i data-lucide="target" class="w-5 h-5 text-[var(--cor-acento-dourado)] mr-3"></i><span>Selecionar Meta</span>`;
                
                if (defaults && defaults.description) nameInput.value = defaults.description;
                if (defaults && defaults.category) {
                    const category = expenseCategoriesWithIcons.find(c => c.name === defaults.category);
                    if (category) {
                        categorySelector.innerHTML = `<i data-lucide="${category.icon}" class="w-5 h-5 text-[var(--cor-acento-dourado)] mr-3"></i><span>${category.name}</span>`;
                        if(category.name === 'Metas') {
                            goalSection.classList.remove('hidden');
                            if(defaults.goal) {
                               const goal = goals.find(g => g.name === defaults.goal);
                               if(goal) goalSelector.innerHTML = `<i data-lucide="${goal.icon}" class="w-5 h-5 text-[var(--cor-acento-dourado)] mr-3"></i><span>${goal.name}</span>`;
                            }
                        }
                    }
                }
                lucide.createIcons();

                const categoryLink = document.getElementById(`${prefix}-category-selector-link`);
                if (categoryLink) {
                    const newCategoryLink = categoryLink.cloneNode(true);
                    categoryLink.parentNode.replaceChild(newCategoryLink, categoryLink);

                    newCategoryLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        const currentForm = document.getElementById(`${prefix}-transaction-form`);
                        if (currentForm) {
                            const selectedTab = currentForm.querySelector('.transaction-type-tab-btn.selected');
                            const type = selectedTab ? selectedTab.dataset.type : 'expense';
                            showScreen(19, { transactionType: type, defaults: defaults });
                        }
                    });
                }
            }

            function showConfirmationModal(message, onConfirm) {
                const modal = document.getElementById('confirmation-modal');
                document.getElementById('modal-message').innerText = message;
                modal.classList.remove('hidden');
                const confirmBtn = document.getElementById('modal-confirm-btn');
                const cancelBtn = document.getElementById('modal-cancel-btn');
                const confirmHandler = () => { onConfirm(); hideModal(); };
                const cancelHandler = () => { hideModal(); };
                const hideModal = () => {
                    modal.classList.add('hidden');
                    confirmBtn.removeEventListener('click', confirmHandler);
                    cancelBtn.removeEventListener('click', cancelHandler);
                };
                confirmBtn.addEventListener('click', confirmHandler, { once: true });
                cancelBtn.addEventListener('click', cancelHandler, { once: true });
            }

            function createOrUpdateCharts() {
                if (barChartInstance) { barChartInstance.destroy(); }
                if (pieChartInstance) { pieChartInstance.destroy(); }
                const textColor = getCssVar('--cor-texto-secundario');
                const gridColor = getCssVar('--cor-borda');
                const barCtx = document.getElementById('mainBarChart').getContext('2d');
                barChartInstance = new Chart(barCtx, { type: 'bar', data: { labels: ['Abr', 'Mai', 'Jun', 'Jul'], datasets: [{ label: 'Receitas', data: [5200, 5300, 5500, 5000], backgroundColor: getCssVar('--cor-receita'), borderRadius: 4, }, { label: 'Despesas', data: [3400, 3800, 4100, 2650], backgroundColor: getCssVar('--cor-despesa'), borderRadius: 4, }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { color: textColor }, grid: { color: gridColor } }, x: { ticks: { color: textColor }, grid: { display: false } } } } });
                const pieCtx = document.getElementById('pieChart').getContext('2d');
                pieChartInstance = new Chart(pieCtx, { type: 'doughnut', data: { labels: ['Moradia', 'Alimentação', 'Transporte'], datasets: [{ data: [1500, 650.20, 500], backgroundColor: [ getCssVar('--cor-moradia'), getCssVar('--cor-alimentacao'), getCssVar('--cor-transporte') ], borderColor: getCssVar('--fundo-elemento'), borderWidth: 4, hoverOffset: 8 }] }, options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { display: false }, tooltip: { callbacks: { label: function(context) { let label = context.label || ''; if (label) { label += ': '; } if (context.parsed !== null) { label += new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(context.parsed); } return label; } } } } } });
            }
            
            // --- QUESTIONNAIRE LOGIC ---
            const questions = [
                "Sinto uma apreensão significativa quando preciso tomar decisões importantes sobre dinheiro.",
                "Confio mais na minha própria análise detalhada do que na opinião geral do mercado ou de especialistas.",
                "A segurança e a preservação do meu dinheiro são mais importantes do que a chance de obter grandes lucros.",
                "Considero as experiências e recomendações de pessoas próximas ao fazer escolhas financeiras.",
                "Busco um equilíbrio claro entre gastar hoje e guardar para o futuro em minhas finanças.",
                "Prefiro manter meu dinheiro em aplicações muito seguras, mesmo que rendam abaixo da inflação.",
                "Prefiro seguir recomendações de consultores financeiros do que fazer minha própria pesquisa aprofundada.",
                "Tomo decisões financeiras importantes rapidamente, confiando na minha intuição ou visão.",
                "Quando vejo algo que me agrada, costumo comprá-lo no momento, mesmo sem ter planejado.",
                "Sinto-me confortável com minha estratégia financeira atual e não vejo necessidade de mudanças drásticas.",
                "Sinto-me tranquilo(a) e confiante sobre minha situação financeira futura.",
                "Gasto tempo entendendo a fundo como funcionam os produtos financeiros ou os bens que compro.",
                "Estou sempre atento(a) a oportunidades de alto crescimento, mesmo que envolvam riscos maiores.",
                "Minhas decisões de compra são baseadas principalmente em necessidade e valor, independente da opinião de outros.",
                "É difícil para mim manter um orçamento ou um plano financeiro consistente.",
                "Mesmo quando tenho dinheiro guardado, a ideia de uma despesa inesperada me causa muita ansiedade.",
                "Minhas decisões de investimento são baseadas primariamente em dados, fatos e lógica.",
                "A possibilidade de um ganho financeiro expressivo me motiva mais do que o medo de perder.",
                "Sinto satisfação em compartilhar boas experiências de compra ou conquistas financeiras com pessoas próximas.",
                "Reviso minhas finanças periodicamente, mas sem obsessão, apenas para garantir que estou no caminho certo.",
                "Tenho dificuldade em gastar dinheiro comigo mesmo(a) em coisas que não sejam estritamente necessárias.",
                "Prefiro estudar detalhadamente os riscos antes de tomar decisões financeiras importantes.",
                "Se eu tiver uma forte convicção sobre um investimento, estou disposto(a) a concentrar uma parte significativa do meu dinheiro nele.",
                "Sinto uma satisfação especial ao comprar algo que está sendo muito comentado ou desejado por outros.",
                "Busco equilibrar segurança e crescimento em minhas decisões financeiras.",
                "Esta pergunta é para verificar sua atenção. Por favor, marque \"Concordo Parcialmente\".",
                "Respondo a questionários sempre com total honestidade, mesmo quando as perguntas são pessoais."
            ];
            const answers = ["Discordo Totalmente", "Discordo Parcialmente", "Neutro/Indeciso", "Concordo Parcialmente", "Concordo Totalmente"];
            let currentQuestionIndex = 0;
            const userAnswers = [];

            const profileInfo = {
                CI: {
                    title: "Coração Inquieto",
                    description: "Você tende a sentir apreensão com decisões financeiras e busca segurança, preferindo caminhos mais cautelosos para proteger seu patrimônio. A ansiedade com gastos inesperados é uma característica presente."
                },
                CA: {
                    title: "Construtor Analítico",
                    description: "Você confia em dados e na sua própria análise detalhada. Gasta tempo entendendo produtos financeiros e baseia suas decisões em lógica, buscando construir seu patrimônio de forma sólida e informada."
                },
                VO: {
                    title: "Visionário Ousado",
                    description: "Motivado por oportunidades de alto crescimento, você não tem medo de correr riscos. Suas decisões são rápidas, baseadas em sua intuição e em uma forte convicção sobre seus investimentos."
                },
                EG: {
                    title: "Explorador Generoso",
                    description: "Suas decisões financeiras são influenciadas por experiências e pelo que está em alta. Você sente satisfação em comprar e compartilhar suas conquistas, explorando novas tendências e oportunidades."
                },
                EC: {
                    title: "Estrategista Consciente",
                    description: "Você busca um equilíbrio claro entre o presente e o futuro, revisando suas finanças periodicamente para garantir que está no caminho certo. Sua abordagem é estratégica, visando segurança e crescimento de forma consciente."
                }
            };

            function calculateResults() {
                const p = userAnswers;
                
                // Formulas based on user specification
                const scores = {
                    CI: (p[0] + p[5] + (6 - p[10]) + p[15] + p[20]),
                    CA: (p[1] + (6 - p[6]) + p[11] + p[16] + (6 - p[21])),
                    VO: ((6 - p[2]) + p[7] + p[12] + p[17] + p[22]),
                    EG: (p[3] + p[8] + (6 - p[13]) + p[18] + p[23]),
                    EC: (p[4] + p[9] + (6 - p[14]) + p[19] + (6 - p[24]))
                };

                const percentages = {
                    CI: Math.round((scores.CI / 25) * 100),
                    CA: Math.round((scores.CA / 25) * 100),
                    VO: Math.round((scores.VO / 25) * 100),
                    EG: Math.round((scores.EG / 25) * 100),
                    EC: Math.round((scores.EC / 25) * 100),
                };
                
                let winnerProfileKey = 'CI';
                let maxScore = -1;

                for (const profileKey in percentages) {
                    if (percentages[profileKey] > maxScore) {
                        maxScore = percentages[profileKey];
                        winnerProfileKey = profileKey;
                    }
                }
                
                return { winner: winnerProfileKey, scores: percentages };
            }

            function displayResults() {
                const { winner, scores } = calculateResults();
                const winnerInfo = profileInfo[winner];

                document.getElementById('profile-result-title').innerText = `Seu Perfil é: ${winnerInfo.title}`;
                document.getElementById('profile-result-description').innerText = winnerInfo.description;

                const scoresContainer = document.getElementById('profile-scores');
                scoresContainer.innerHTML = '<h3 class="text-md font-semibold text-center mb-3">Sua Pontuação</h3>'; // Clear previous scores
                
                const profileNames = { CI: 'Coração Inquieto', CA: 'Construtor Analítico', VO: 'Visionário Ousado', EG: 'Explorador Generoso', EC: 'Estrategista Consciente' };

                for(const profileKey in scores) {
                    const scoreElement = document.createElement('div');
                    scoreElement.className = 'flex justify-between items-center text-sm';
                    scoreElement.innerHTML = `
                        <span>${profileNames[profileKey]}</span>
                        <span class="font-bold">${scores[profileKey]}%</span>
                    `;
                    scoresContainer.appendChild(scoreElement);
                }
            }

            function loadQuestion(index) {
                const questionText = document.getElementById('question-text');
                const answerOptions = document.getElementById('answer-options');
                const progressBar = document.getElementById('progress-bar');
                const nextBtn = document.getElementById('next-question-btn');
                if(!questionText || !answerOptions || !progressBar || !nextBtn) return;
                
                questionText.innerText = questions[index];
                answerOptions.innerHTML = '';
                
                answers.forEach((answer, i) => {
                    const button = document.createElement('button');
                    button.innerText = answer;
                    button.className = 'answer-btn w-full py-3 text-sm font-medium rounded-md border-2 border-[var(--cor-borda)] hover:bg-[var(--fundo-card)]';
                    button.dataset.value = i + 1;
                    button.addEventListener('click', () => {
                        answerOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
                        button.classList.add('selected');
                        nextBtn.disabled = false;
                        userAnswers[index] = i + 1;
                    });
                    answerOptions.appendChild(button);
                });

                progressBar.style.width = `${((index + 1) / questions.length) * 100}%`;
                nextBtn.disabled = true;
                if (index === questions.length - 1) { nextBtn.innerText = 'Finalizar'; } else { nextBtn.innerText = 'Próximo'; }
            }

            // --- TRANSACTION VIEW & FILTERS LOGIC ---
            function renderTransactions(filterByAccount = null) {
                const listContainer = document.getElementById(filterByAccount ? 'account-detail-transaction-list' : 'transaction-list');
                const templateContainer = document.getElementById('all-transactions-template');
                if (!listContainer || !templateContainer) return;
                listContainer.innerHTML = '';

                let allItemsData = Array.from(templateContainer.children).map(item => item.dataset);

                if (filterByAccount) {
                    allItemsData = allItemsData.filter(data => data.account === filterByAccount);
                } else {
                     allItemsData = allItemsData.filter(data => {
                        if (activeTransactionView === 'todos') return true;
                        if (activeTransactionView === 'contas') return data.sourceType === 'account';
                        if (activeTransactionView === 'cartoes') return data.sourceType === 'card';
                        return false;
                    });
                }

                const groupedByDate = allItemsData.reduce((acc, data) => {
                    const date = data.date;
                    if (!acc[date]) acc[date] = [];
                    acc[date].push(data);
                    return acc;
                }, {});

                const sortedDates = Object.keys(groupedByDate).sort((a, b) => {
                    const dateA = new Date(a.replace(/(\d+) de (\w+), (\d+)/, '$2 $1, $3'));
                    const dateB = new Date(b.replace(/(\d+) de (\w+), (\d+)/, '$2 $1, $3'));
                    return dateB - dateA;
                });

                if (sortedDates.length === 0) {
                    listContainer.innerHTML = `<p class="text-center text-[var(--cor-texto-secundario)] p-8">Nenhum lançamento para esta conta.</p>`;
                    return;
                }

                sortedDates.forEach(date => {
                    const dateGroupContainer = document.createElement('div');
                    dateGroupContainer.className = 'py-3 date-group';

                    const dateHeader = document.createElement('p');
                    dateHeader.className = 'text-sm font-bold text-[var(--cor-texto-secundario)] mb-2 px-3';
                    dateHeader.innerText = date;
                    dateGroupContainer.appendChild(dateHeader);
                    
                    const itemsContainer = document.createElement('div');
                    itemsContainer.className = 'space-y-1';

                    groupedByDate[date].forEach(data => {
                        const itemEl = document.createElement('div');
                        itemEl.className = 'transaction-item bg-[var(--fundo-elemento)] p-3 rounded-lg flex justify-between items-center cursor-pointer hover:bg-white/10';
                        Object.keys(data).forEach(key => itemEl.dataset[key] = data[key]);

                        const { title, value, category, type, status } = data;
                        const iconMap = { 'income': 'briefcase', 'expense': 'shopping-cart', 'transfer': 'repeat', 'Moradia': 'home', 'Alimentação': 'shopping-cart', 'Transporte': 'car', 'Lazer': 'gamepad-2', 'Saúde': 'heart-pulse', 'Educação': 'book-open', 'Salário': 'briefcase', 'Vendas': 'dollar-sign', 'Investimentos': 'trending-up', 'Metas': 'target' };
                        const colorMap = { 'income': '--cor-receita', 'expense': '--cor-despesa', 'transfer': '--cor-transferencia' };
                        const statusColorMap = { 'pago': 'text-[var(--cor-receita)]', 'pendente': 'text-[var(--cor-despesa)]' };
                        const statusTextMap = { 'pago': 'pago', 'pendente': 'pendente' };
                        if(type === 'income') statusTextMap.pago = 'recebido';

                        itemEl.innerHTML = `
                            <div class="flex items-center overflow-hidden mr-2">
                                <div class="w-10 h-10 flex-shrink-0 flex items-center justify-center rounded-full bg-[#002147] mr-3">
                                    <i data-lucide="${iconMap[category] || iconMap[type] || 'tag'}" class="w-5 h-5" style="color: var(${colorMap[type]})"></i>
                                </div>
                                <div class="truncate">
                                    <p class="font-semibold text-[var(--cor-texto-principal)] truncate">${title}</p>
                                    <p class="text-xs text-[var(--cor-texto-secundario)] truncate">${category}</p>
                                </div>
                            </div>
                            <div class="text-right flex-shrink-0">
                                <p class="font-bold" style="color: var(${colorMap[type]})">${value}</p>
                                ${status ? `<p class="text-xs ${statusColorMap[status]}">${statusTextMap[status]}</p>` : ''}
                            </div>
                        `;
                        itemEl.addEventListener('click', () => showTransactionDetail(itemEl));
                        itemsContainer.appendChild(itemEl);
                    });

                    dateGroupContainer.appendChild(itemsContainer);
                    listContainer.appendChild(dateGroupContainer);
                });

                lucide.createIcons();
                if(!filterByAccount) applyFilters();
            }


            function setupFilterScreen() {
                const accounts = accountsAndCards.filter(a => a.type === 'account').map(a => a.name);
                const cards = accountsAndCards.filter(a => a.type === 'card').map(a => a.name);
                const allCategories = [...new Set([...expenseCategoriesWithIcons, ...incomeCategoriesWithIcons].map(c => c.name))];

                populateFilterOptions('filter-account-options', accounts, 'account');
                populateFilterOptions('filter-card-options', cards, 'card');
                populateFilterOptions('filter-category-options', allCategories, 'category');

                document.getElementById('filter-section-type').style.display = activeTransactionView === 'todos' ? 'block' : 'none';
                document.getElementById('filter-section-accounts').style.display = ['todos', 'contas'].includes(activeTransactionView) ? 'block' : 'none';
                document.getElementById('filter-section-cards').style.display = ['todos', 'cartoes'].includes(activeTransactionView) ? 'block' : 'none';
                document.getElementById('filter-section-status').style.display = activeTransactionView !== 'cartoes' ? 'block' : 'none';


                document.querySelectorAll('#screen-21 .filter-chip-btn').forEach(btn => {
                    btn.addEventListener('click', () => btn.classList.toggle('selected'));
                });
            }

            function populateFilterOptions(containerId, options, group) {
                const container = document.getElementById(containerId);
                if (!container) return;
                container.innerHTML = '';
                options.forEach(option => {
                    const btn = document.createElement('button');
                    btn.className = 'filter-chip-btn py-2 px-4 rounded-full border-2 border-[var(--cor-borda)] text-sm';
                    btn.dataset.filterGroup = group;
                    btn.dataset.filterValue = option;
                    btn.innerText = option;
                    container.appendChild(btn);
                });
            }

            function applyFilters() {
                const selectedTypes = Array.from(document.querySelectorAll('#filter-type-options .selected')).map(btn => btn.dataset.filterValue);
                const selectedStatuses = Array.from(document.querySelectorAll('#filter-status-options .selected')).map(btn => btn.dataset.filterValue);
                const selectedAccounts = [
                    ...Array.from(document.querySelectorAll('#filter-account-options .selected')),
                    ...Array.from(document.querySelectorAll('#filter-card-options .selected'))
                ].map(btn => btn.dataset.filterValue);
                const selectedCategories = Array.from(document.querySelectorAll('#filter-category-options .selected')).map(btn => btn.dataset.filterValue);

                const allTransactionItems = document.querySelectorAll('#transaction-list .transaction-item');
                
                allTransactionItems.forEach(item => {
                    const itemSourceType = item.dataset.sourceType;
                    const itemType = item.dataset.type;
                    const itemStatus = item.dataset.status;
                    const itemAccount = item.dataset.account;
                    const itemCategory = item.dataset.category;

                    const viewMatch = activeTransactionView === 'todos' || 
                                      (activeTransactionView === 'contas' && itemSourceType === 'account') ||
                                      (activeTransactionView === 'cartoes' && itemSourceType === 'card');

                    const typeMatch = selectedTypes.length === 0 || selectedTypes.includes(itemType);
                    const statusMatch = selectedStatuses.length === 0 || item.dataset.sourceType === 'card' || selectedStatuses.includes(itemStatus);
                    const accountMatch = selectedAccounts.length === 0 || selectedAccounts.includes(itemAccount);
                    const categoryMatch = selectedCategories.length === 0 || selectedCategories.includes(itemCategory);

                    if (viewMatch && typeMatch && statusMatch && accountMatch && categoryMatch) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });

                const dateGroups = document.querySelectorAll('#transaction-list .date-group');
                let hasVisibleItems = false;
                dateGroups.forEach(group => {
                    const visibleItemsInGroup = group.querySelectorAll('.transaction-item[style*="display: flex"]');
                    if (visibleItemsInGroup.length > 0) {
                        group.style.display = 'block';
                        hasVisibleItems = true;
                    } else {
                        group.style.display = 'none';
                    }
                });

                const listContainer = document.getElementById('transaction-list');
                const noResultsMessage = listContainer.querySelector('.no-results-message');
                if (noResultsMessage) noResultsMessage.remove();

                if (!hasVisibleItems && listContainer) {
                     listContainer.innerHTML += `<p class="no-results-message text-center text-[var(--cor-texto-secundario)] p-8">Nenhum lançamento encontrado com os filtros selecionados.</p>`;
                }
            }

            // --- DASHBOARD SETUP ---
            function setupDashboard() {
                // Balance Toggle
                const toggleBtn = document.getElementById('toggle-balance-btn');
                const balanceEl = document.getElementById('balance-amount');
                if (toggleBtn && balanceEl) {
                    if (!toggleBtn.hasListener) {
                        let balanceVisible = true;
                        toggleBtn.addEventListener('click', () => {
                            balanceVisible = !balanceVisible;
                            balanceEl.innerText = balanceVisible ? 'R$ 12.450,75' : 'R$ ••••••';
                            toggleBtn.innerHTML = `<i data-lucide="${balanceVisible ? 'eye' : 'eye-off'}" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>`;
                            lucide.createIcons();
                        });
                        toggleBtn.hasListener = true;
                    }
                }

                // Populate Carousels
                populateAccountsCarousel();
                populateCardsCarousel();
                populateRecentTransactionsCarousel();
                createDashboardPieChart();
            }

            function populateAccountsCarousel() {
                const container = document.getElementById('accounts-carousel');
                if (!container) return;
                container.innerHTML = '';
                accountsAndCards.filter(item => item.type === 'account').forEach(account => {
                    const card = document.createElement('div');
                    card.className = 'w-40 h-24 p-3 rounded-xl bg-[var(--fundo-card)] flex flex-col justify-between cursor-pointer';
                    card.addEventListener('click', () => showScreen(26, { account: account }));
                    card.innerHTML = `
                        <div>
                            <p class="font-bold text-sm">${account.bank}</p>
                            <p class="text-xs text-[var(--cor-texto-secundario)]">${account.name}</p>
                        </div>
                        <p class="font-bold text-lg text-right">${account.balance}</p>
                    `;
                    container.appendChild(card);
                });
                // Add "Add Account" button
                container.innerHTML += `
                    <div class="w-40 h-24 rounded-xl bg-[var(--fundo-elemento)] border-2 border-dashed border-[var(--cor-borda)] flex items-center justify-center cursor-pointer hover:bg-white/10" onclick="showScreen(25)">
                        <div class="text-center">
                            <i data-lucide="plus" class="w-6 h-6 mx-auto text-[var(--cor-texto-secundario)]"></i>
                            <p class="mt-1 text-xs font-semibold text-[var(--cor-texto-secundario)]">Adicionar Conta</p>
                        </div>
                    </div>`;
                lucide.createIcons();
            }

            function populateCardsCarousel() {
                const container = document.getElementById('cards-carousel');
                 if (!container) return;
                container.innerHTML = '';
                accountsAndCards.filter(item => item.type === 'card').forEach(card => {
                    const cardEl = document.createElement('div');
                    cardEl.className = 'w-40 h-24 p-3 rounded-xl bg-gradient-to-br from-gray-700 to-gray-900 flex flex-col justify-between cursor-pointer';
                    cardEl.addEventListener('click', () => showScreen(17));
                    cardEl.innerHTML = `
                        <span class="text-white font-bold text-sm">Castelo Bank</span>
                        <div>
                            <p class="text-gray-300 text-xs">${card.name.replace(' Final', '...')}</p>
                            <p class="text-white font-mono tracking-wider text-sm">**** ${card.name.slice(-4)}</p>
                        </div>
                    `;
                    container.appendChild(cardEl);
                });
                 // Add "Add Card" button
                container.innerHTML += `
                    <div class="w-40 h-24 rounded-xl bg-[var(--fundo-elemento)] border-2 border-dashed border-[var(--cor-borda)] flex items-center justify-center cursor-pointer hover:bg-white/10" onclick="showScreen(18)">
                        <div class="text-center">
                            <i data-lucide="plus" class="w-6 h-6 mx-auto text-[var(--cor-texto-secundario)]"></i>
                            <p class="mt-1 text-xs font-semibold text-[var(--cor-texto-secundario)]">Adicionar Cartão</p>
                        </div>
                    </div>`;
                lucide.createIcons();
            }

            function populateAllAccountsScreen() {
                const container = document.getElementById('all-accounts-list');
                if (!container) return;
                container.innerHTML = ''; // Clear existing content
                accountsAndCards.filter(item => item.type === 'account').forEach(account => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'bg-[var(--fundo-card)] p-4 rounded-lg flex justify-between items-center cursor-pointer';
                    itemEl.addEventListener('click', () => showScreen(26, { account: account }));
                    itemEl.innerHTML = `
                        <div class="flex items-center">
                            <i data-lucide="${account.icon}" class="w-8 h-8 text-[var(--cor-acento-dourado)] mr-4"></i>
                            <div>
                                <p class="font-bold text-md">${account.bank}</p>
                                <p class="text-sm text-[var(--cor-texto-secundario)]">${account.name}</p>
                            </div>
                        </div>
                        <p class="font-bold text-lg">${account.balance}</p>
                    `;
                    container.appendChild(itemEl);
                });
                lucide.createIcons();
            }

            function populateAllCardsScreen() {
                const container = document.getElementById('all-cards-list');
                if (!container) return;
                container.innerHTML = ''; // Clear existing content
                accountsAndCards.filter(item => item.type === 'card').forEach(card => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'w-full p-4 rounded-2xl bg-gradient-to-br from-gray-700 to-gray-900 flex flex-col justify-between shadow-lg cursor-pointer';
                    itemEl.addEventListener('click', () => showScreen(17));
                    itemEl.innerHTML = `
                        <div class="flex justify-between items-start">
                            <span class="text-white font-bold text-lg">Castelo Bank</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12" viewBox="0 0 24 24"><circle cx="10" cy="12" r="7" fill="#EA001B"/><circle cx="14" cy="12" r="7" fill="#F79E1B" fill-opacity=".8"/></svg>
                        </div>
                        <div>
                            <p class="text-white font-mono tracking-widest text-xl mb-1">**** **** **** ${card.name.slice(-4)}</p>
                            <div class="flex justify-between text-sm">
                                <p class="text-gray-300">Usuário</p>
                                <p class="text-gray-300">12/29</p>
                            </div>
                        </div>
                    `;
                    container.appendChild(itemEl);
                });
            }
            
            function populateRecentTransactionsCarousel() {
                const container = document.getElementById('recent-transactions-carousel');
                if (!container) return;
                container.innerHTML = '';
                const templateContainer = document.getElementById('all-transactions-template');
                const allItemsData = Array.from(templateContainer.children).map(item => item.dataset).slice(0, 5); // Get first 5 for example

                allItemsData.forEach(data => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'transaction-item bg-[var(--fundo-card)] p-3 rounded-lg flex-shrink-0 w-60 flex items-center cursor-pointer hover:bg-white/10';
                    Object.keys(data).forEach(key => itemEl.dataset[key] = data[key]);

                    const { title, value, category, type } = data;
                    const iconMap = { 'income': 'briefcase', 'expense': 'shopping-cart', 'transfer': 'repeat', 'Moradia': 'home', 'Alimentação': 'shopping-cart', 'Transporte': 'car', 'Lazer': 'gamepad-2', 'Saúde': 'heart-pulse', 'Educação': 'book-open', 'Salário': 'briefcase', 'Vendas': 'dollar-sign', 'Investimentos': 'trending-up', 'Metas': 'target' };
                    const colorMap = { 'income': '--cor-receita', 'expense': '--cor-despesa', 'transfer': '--cor-transferencia' };

                    itemEl.innerHTML = `
                        <div class="w-10 h-10 flex-shrink-0 flex items-center justify-center rounded-full bg-[#002147] mr-3">
                            <i data-lucide="${iconMap[category] || iconMap[type] || 'tag'}" class="w-5 h-5" style="color: var(${colorMap[type]})"></i>
                        </div>
                        <div class="truncate">
                            <p class="font-semibold text-[var(--cor-texto-principal)] truncate">${title}</p>
                            <p class="font-bold text-sm" style="color: var(${colorMap[type]})">${value}</p>
                        </div>
                    `;
                    itemEl.addEventListener('click', () => showTransactionDetail(itemEl));
                    container.appendChild(itemEl);
                });
                 lucide.createIcons();
            }

            function createDashboardPieChart() {
                 if (dashboardPieChartInstance) { dashboardPieChartInstance.destroy(); }
                 const pieCtx = document.getElementById('dashboard-pie-chart').getContext('2d');
                 if(!pieCtx) return;
                 dashboardPieChartInstance = new Chart(pieCtx, { type: 'doughnut', data: { labels: ['Moradia', 'Alimentação', 'Transporte', 'Lazer'], datasets: [{ data: [1500, 704.50, 0, 39.90], backgroundColor: [ getCssVar('--cor-moradia'), getCssVar('--cor-alimentacao'), getCssVar('--cor-transporte'), getCssVar('--cor-viagem') ], borderColor: getCssVar('--fundo-elemento'), borderWidth: 4, hoverOffset: 8 }] }, options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { display: false }, tooltip: { callbacks: { label: function(context) { let label = context.label || ''; if (label) { label += ': '; } if (context.parsed !== null) { label += new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(context.parsed); } return label; } } } } } });
            }

            function populateAccountDetailScreen(account) {
                if (!account) return;
                document.getElementById('account-detail-name').innerText = account.name;
                document.getElementById('account-detail-balance').innerText = account.balance;
                renderTransactions(account.name);
            }

            function setupEventListeners() {
                const nextButton = document.getElementById('next-screen-btn');
                if (nextButton) {
                    nextButton.addEventListener('click', () => {
                        const mainScreens = [0, 1, 2, 3, 8, 7, 9];
                        let currentIndexInSequence = mainScreens.indexOf(currentScreenIndex);
                        if (currentIndexInSequence === -1) { currentIndexInSequence = 1; }
                        const nextIndexInSequence = (currentIndexInSequence + 1) % mainScreens.length;
                        const nextScreenId = mainScreens[nextIndexInSequence];
                        showScreen(nextScreenId);
                    });
                }

                navLinks.forEach(link => {
                    link.addEventListener('click', (e) => { 
                        e.preventDefault(); 
                        const screenIndex = parseInt(link.getAttribute('data-screen'), 10);
                        if(!isNaN(screenIndex)) showScreen(screenIndex);
                    });
                });

                const screen0Button = document.querySelector('#screen-0 form button');
                if (screen0Button) screen0Button.addEventListener('click', () => showScreen(1));
                
                const profilePic = document.getElementById('profile-pic');
                if (profilePic) profilePic.addEventListener('click', () => showScreen(7));
                
                const notificationsBtn = document.getElementById('notifications-btn');
                if (notificationsBtn) notificationsBtn.addEventListener('click', () => showScreen(9));
                
                const plansBtn = document.getElementById('plans-btn');
                if (plansBtn) plansBtn.addEventListener('click', () => showScreen(16));
                
                document.querySelectorAll('.close-modal').forEach(btn => btn.addEventListener('click', () => showScreen(1)));
                
                const saveBtn = document.getElementById('save-new-transaction-btn');
                if (saveBtn) saveBtn.addEventListener('click', () => showScreen(1));
                
                document.querySelectorAll('.prev-month-btn').forEach(btn => btn.addEventListener('click', () => {
                    currentDate.setMonth(currentDate.getMonth() - 1);
                    updateAllMonthDisplays();
                }));
                document.querySelectorAll('.next-month-btn').forEach(btn => btn.addEventListener('click', () => {
                    currentDate.setMonth(currentDate.getMonth() + 1);
                    updateAllMonthDisplays();
                }));
                
                const deleteTransactionBtn = document.getElementById('delete-transaction-btn');
                if (deleteTransactionBtn) {
                    deleteTransactionBtn.addEventListener('click', () => {
                        showConfirmationModal('Deseja realmente excluir este lançamento?', () => {
                            if(currentTransactionToEdit) { currentTransactionToEdit.remove(); }
                            showScreen(2);
                        });
                    });
                }

                const editTransactionBtn = document.getElementById('edit-transaction-btn');
                if (editTransactionBtn) {
                    editTransactionBtn.addEventListener('click', () => {
                        alert("A tela de edição precisa ser implementada com o novo layout.");
                    });
                }

                const deleteGoalBtn = document.getElementById('delete-goal-btn');
                if (deleteGoalBtn) {
                     deleteGoalBtn.addEventListener('click', () => {
                        showConfirmationModal('Deseja realmente excluir esta meta?', () => { showScreen(8); });
                    });
                }
                
                const addGoalTransactionBtn = document.getElementById('add-goal-transaction-btn');
                if (addGoalTransactionBtn) {
                    addGoalTransactionBtn.addEventListener('click', () => {
                        const goalTitleEl = document.getElementById('goal-detail-title');
                        if(goalTitleEl) {
                            const goalTitle = goalTitleEl.innerText;
                            showScreen(5, { defaults: {
                                category: 'Metas',
                                goal: goalTitle,
                                description: `Aporte para meta: ${goalTitle}`
                            }});
                        }
                    });
                }

                const questionnaireCard = document.getElementById('questionnaire-card');
                if (questionnaireCard) {
                    questionnaireCard.addEventListener('click', () => {
                        currentQuestionIndex = 0;
                        userAnswers.length = 0;
                        showScreen(14);
                        loadQuestion(currentQuestionIndex);
                    });
                }
                
                const nextQuestionBtn = document.getElementById('next-question-btn');
                if (nextQuestionBtn) {
                     nextQuestionBtn.addEventListener('click', () => {
                        if (currentQuestionIndex < questions.length - 1) {
                            currentQuestionIndex++;
                            loadQuestion(currentQuestionIndex);
                        } else {
                            displayResults();
                            showScreen(15);
                        }
                    });
                }
                
                const skipQuestionnaireBtn = document.getElementById('skip-questionnaire-btn');
                if (skipQuestionnaireBtn) skipQuestionnaireBtn.addEventListener('click', () => showScreen(1));

                document.querySelectorAll('.card-carousel').forEach(carousel => {
                     let isDown = false, startX, scrollLeft, isDragging = false;
                    carousel.addEventListener('mousedown', (e) => {
                        isDown = true; isDragging = false; carousel.classList.add('active');
                        startX = e.pageX - carousel.offsetLeft; scrollLeft = carousel.scrollLeft;
                    });
                    carousel.addEventListener('mouseleave', () => { isDown = false; carousel.classList.remove('active'); });
                    carousel.addEventListener('mouseup', (e) => {
                        isDown = false; carousel.classList.remove('active');
                        if(isDragging) { e.preventDefault(); }
                    });
                    carousel.addEventListener('mousemove', (e) => {
                        if (!isDown) return; e.preventDefault(); isDragging = true;
                        const x = e.pageX - carousel.offsetLeft;
                        const walk = (x - startX) * 2;
                        carousel.scrollLeft = scrollLeft - walk;
                    });
                    Array.from(carousel.children).forEach(child => {
                        child.addEventListener('click', (e) => { if(isDragging) { e.preventDefault(); e.stopPropagation(); } });
                    });
                });
                
                const prevBillBtn = document.getElementById('prev-bill-btn');
                if (prevBillBtn) prevBillBtn.addEventListener('click', () => {
                    if (currentBillIndex > 0) { currentBillIndex--; updateBillDisplay(); }
                });
                
                const nextBillBtn = document.getElementById('next-bill-btn');
                if (nextBillBtn) nextBillBtn.addEventListener('click', () => {
                    if (currentBillIndex < sampleBills.length - 1) { currentBillIndex++; updateBillDisplay(); }
                });

                const openFilterBtn = document.getElementById('open-filter-btn');
                if (openFilterBtn) openFilterBtn.addEventListener('click', () => showScreen(21));
                
                document.querySelectorAll('.view-tab-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.view-tab-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        activeTransactionView = btn.dataset.view;
                        renderTransactions();
                    });
                });

                const resetFiltersBtn = document.getElementById('reset-filters-btn');
                if (resetFiltersBtn) {
                    resetFiltersBtn.addEventListener('click', () => {
                        document.querySelectorAll('#screen-21 .filter-chip-btn.selected').forEach(btn => {
                            btn.classList.remove('selected');
                        });
                    });
                }

                const applyFiltersBtn = document.getElementById('apply-filters-btn');
                if (applyFiltersBtn) {
                    applyFiltersBtn.addEventListener('click', () => {
                        applyFilters();
                        showScreen(2);
                    });
                }
            }

            setupEventListeners();
            showScreen(0);
            updateAllMonthDisplays();
        });
    </script>
</body>
</html>
