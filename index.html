<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Castelo Forte - Protótipo Mobile</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Fundo da página com um tom escuro para combinar com o app */
            background-color: #001a3a;
        }
        :root {
            /* Paleta de Cores com Azul Marinho e Dourado */
            --fundo-principal: #002147; /* Azul Marinho (0, 33, 71) */
            --fundo-card: #0a2b52;      /* Tom de azul um pouco mais claro para os cards */
            --fundo-elemento: #0a2b52;  /* Consistência para elementos de interface */
            
            --cor-texto-principal: #FFFFFF;
            --cor-texto-secundario: #a0aec0; /* Cinza azulado para melhor harmonia */
            
            --cor-borda: #1e3a5f;

            /* Cores de Acento com Dourado como principal */
            --cor-acento-dourado: #C4A35A;   /* Dourado (196, 163, 90) */
            --cor-acento-dourado-hover: #b89854; /* Tom mais escuro para hover */
            
            /* Cores de Feedback */
            --cor-receita: #34C759;  /* Verde para receitas */
            --cor-despesa: #FF3B30;  /* Vermelho para despesas */
            --cor-transferencia: #a0aec0; /* Cor neutra para transferências */
            --cor-moradia: #FF6384;
            --cor-alimentacao: #FF9F40;
            --cor-transporte: #4BC0C0;
            --cor-viagem: #36A2EB;
        }

        .mobile-screen-content::-webkit-scrollbar { display: none; }
        .mobile-screen-content { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Estilo para botão de tipo de transação selecionado */
        .transaction-type-btn, .theme-btn, .filter-btn, .category-btn {
            background-color: transparent;
            transition: all 0.2s ease-in-out;
        }
        .transaction-type-btn.selected, .theme-btn.selected, .filter-btn.selected, .category-btn.selected {
            background-color: var(--cor-selecionada, var(--fundo-elemento));
            color: white;
            font-weight: bold;
            border-color: transparent;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-sm h-[85vh] min-h-[640px] rounded-3xl shadow-2xl border-8 border-black overflow-hidden">
        <div id="app-container" class="w-full h-full bg-[var(--fundo-principal)] text-[var(--cor-texto-principal)] relative">
            
            <!-- TELA DE LOGIN -->
            <div id="screen-0" class="screen w-full h-full flex flex-col items-center justify-center p-6 z-10">
                <div class="w-full max-w-md text-center">
                    <img src="https://castelofortegroup.com/wp-content/uploads/2025/04/logo-castelo-forte-horizontal-cor-branco-300x91.png.webp" alt="Logo Castelo Forte" class="mx-auto w-56 mb-8" onerror="this.onerror=null; this.src='https://placehold.co/300x91/002147/ffffff?text=Castelo+Forte';">
                    <form class="space-y-4" onsubmit="event.preventDefault();">
                        <input type="email" required class="appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md focus:outline-none focus:ring-[var(--cor-acento-dourado)] focus:border-[var(--cor-acento-dourado)] sm:text-sm" placeholder="Email">
                        <input type="password" required class="appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md focus:outline-none focus:ring-[var(--cor-acento-dourado)] focus:border-[var(--cor-acento-dourado)] sm:text-sm" placeholder="Senha">
                        <button type="button" class="w-full flex justify-center py-3 px-4 border border-transparent text-sm font-bold rounded-md text-[var(--fundo-principal)] bg-[var(--cor-acento-dourado)] hover:bg-[var(--cor-acento-dourado-hover)] transition-colors">Entrar</button>
                    </form>
                    <div class="mt-6">
                        <div class="relative"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-[var(--cor-borda)]"></div></div><div class="relative flex justify-center text-sm"><span class="px-2 bg-[var(--fundo-principal)] text-[var(--cor-texto-secundario)]">ou entre com</span></div></div>
                        <div class="mt-4"><button type="button" class="w-full inline-flex justify-center py-2 px-4 border border-[var(--cor-borda)] rounded-md shadow-sm bg-[var(--fundo-elemento)] text-sm font-medium text-[var(--cor-texto-principal)] hover:bg-opacity-80 transition-colors"><svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 0C4.477 0 0 4.477 0 10c0 4.418 2.865 8.166 6.839 9.49.5.092.682-.217.682-.482 0-.237-.009-.868-.014-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.031-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.378.203 2.398.1 2.651.64.7 1.03 1.595 1.03 2.688 0 3.848-2.338 4.695-4.566 4.943.359.308.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.001 10.001 0 0020 10c0-5.523-4.477-10-10-10z" clip-rule="evenodd" /></svg><span class="ml-3">Google</span></button></div>
                    </div>
                    <p class="mt-8 text-center text-sm text-[var(--cor-texto-secundario)]">Não tem uma conta? <a href="#" class="font-medium text-[var(--cor-acento-dourado)] hover:text-[var(--cor-acento-dourado-hover)] transition-colors">Crie uma conta</a></p>
                </div>
            </div>

            <!-- TELA DO DASHBOARD -->
            <div id="screen-1" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-20 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                    <div id="profile-pic" class="flex items-center space-x-3 cursor-pointer">
                        <img class="w-12 h-12 rounded-full border-2 border-[var(--cor-acento-dourado)]" src="https://placehold.co/100x100/0a2b52/C4A35A?text=U" alt="Avatar do usuário">
                        <div>
                            <p class="text-sm text-[var(--cor-texto-secundario)]">Boa tarde,</p>
                            <p class="font-bold text-[var(--cor-texto-principal)]">Usuário</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <i id="notifications-btn" data-lucide="bell" class="w-6 h-6 text-[var(--cor-texto-secundario)] hover:text-[var(--cor-acento-dourado)] transition-colors cursor-pointer"></i>
                    </div>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content pb-24 space-y-5">
                    <div class="bg-[var(--fundo-elemento)] p-5 rounded-xl text-center"><h3 class="text-sm text-[var(--cor-texto-secundario)]">Saldo disponível</h3><p class="text-3xl font-bold text-[var(--cor-acento-dourado)] mt-1">R$ 12.450,75</p></div>
                    <div class="bg-[var(--fundo-elemento)] p-5 rounded-xl text-center"><div class="flex justify-center items-center space-x-2"><i data-lucide="wallet" class="w-8 h-8 text-[var(--cor-acento-dourado)]"></i><i data-lucide="link" class="w-6 h-6 text-[var(--cor-texto-secundario)]"></i><i data-lucide="landmark" class="w-8 h-8 text-[var(--cor-acento-dourado)]"></i></div><h3 class="text-lg font-bold text-[var(--cor-texto-principal)] mt-4">Conexão Bancária</h3><p class="text-sm text-[var(--cor-texto-secundario)] mt-2">Conecte seus bancos e importe seus lançamentos.</p><button class="w-full mt-4 py-3 px-4 text-sm font-bold rounded-md text-[var(--fundo-principal)] bg-[var(--cor-acento-dourado)] hover:bg-[var(--cor-acento-dourado-hover)] transition-colors duration-300">Começar agora</button></div>
                    <div class="bg-[var(--fundo-elemento)] p-5 rounded-xl"><h3 class="text-md font-semibold text-[var(--cor-texto-principal)] mb-4">Últimos Lançamentos</h3><div class="space-y-4"><div class="flex items-center justify-between"><div class="flex items-center space-x-3"><i data-lucide="arrow-up-circle" class="w-6 h-6 text-[var(--cor-receita)]"></i><p class="text-[var(--cor-texto-principal)]">Salário</p></div><p class="font-medium text-[var(--cor-receita)]">+ R$ 5.000,00</p></div><div class="flex items-center justify-between"><div class="flex items-center space-x-3"><i data-lucide="arrow-down-circle" class="w-6 h-6 text-[var(--cor-despesa)]"></i><p class="text-[var(--cor-texto-principal)]">Aluguel</p></div><p class="font-medium text-[var(--cor-despesa)]">- R$ 1.500,00</p></div></div></div>
                </main>
            </div>

            <!-- TELA DE LANÇAMENTOS -->
            <div id="screen-2" class="screen hidden w-full h-full flex flex-col">
                 <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]"><h1 class="text-xl font-bold text-[var(--cor-texto-principal)]">Lançamentos</h1></header>
                <main class="flex-1 overflow-y-auto mobile-screen-content pb-36">
                    <div class="p-4 sticky top-0 bg-[var(--fundo-principal)] z-10">
                        <div class="flex justify-between items-center text-center">
                            <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer prev-month-btn"></i>
                            <div class="flex-1 flex justify-center items-center space-x-2">
                                <span class="text-[var(--cor-texto-secundario)] prev-month-text"></span>
                                <span class="py-2 px-4 bg-[var(--fundo-elemento)] text-[var(--cor-texto-principal)] font-bold rounded-full month-display"></span>
                                <span class="text-[var(--cor-texto-secundario)] next-month-text"></span>
                            </div>
                            <i data-lucide="chevron-right" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer next-month-btn"></i>
                        </div>
                        <div id="filter-buttons" class="mt-4 grid grid-cols-3 gap-2 text-sm">
                            <button class="filter-btn py-2 px-3 rounded-full selected" data-filter="all">Todos</button>
                            <button class="filter-btn py-2 px-3 rounded-full text-[var(--cor-texto-secundario)]" data-filter="income">Receitas</button>
                            <button class="filter-btn py-2 px-3 rounded-full text-[var(--cor-texto-secundario)]" data-filter="expense">Despesas</button>
                        </div>
                    </div>
                    <div id="transaction-list" class="px-4 space-y-1">
                        <div class="py-3">
                            <p class="text-sm font-bold text-[var(--cor-texto-secundario)] mb-2 px-3">Hoje</p>
                            <div class="space-y-1">
                                <div class="transaction-item bg-[var(--fundo-elemento)] p-3 rounded-lg flex justify-between items-center cursor-pointer hover:bg-white/10" data-type="expense" data-title="Supermercado" data-category="Alimentação" data-value="- R$ 650,20" data-date="03 de Julho, 2025" data-account="Conta Corrente" data-description="Compra mensal de supermercado.">
                                    <div class="flex items-center"><div class="w-10 h-10 flex items-center justify-center rounded-full bg-[#002147] mr-3"><i data-lucide="shopping-cart" class="w-5 h-5 text-[var(--cor-despesa)]"></i></div><div><p class="font-semibold text-[var(--cor-texto-principal)]">Supermercado</p><p class="text-xs text-[var(--cor-texto-secundario)]">Alimentação</p></div></div><p class="font-bold text-[var(--cor-despesa)]">- R$ 650,20</p>
                                </div>
                                <div class="transaction-item bg-[var(--fundo-elemento)] p-3 rounded-lg flex justify-between items-center cursor-pointer hover:bg-white/10" data-type="transfer" data-title="Transferência" data-category="Transferência" data-value="- R$ 500,00" data-date="03 de Julho, 2025" data-account="Conta Poupança" data-description="Transferência para cobrir despesas na conta corrente.">
                                    <div class="flex items-center"><div class="w-10 h-10 flex items-center justify-center rounded-full bg-[#002147] mr-3"><i data-lucide="repeat" class="w-5 h-5 text-sky-400"></i></div><div><p class="font-semibold text-[var(--cor-texto-principal)]">Transferência</p><p class="text-xs text-[var(--cor-texto-secundario)]">Para: Conta Corrente</p></div></div><p class="font-bold text-[var(--cor-transferencia)]">- R$ 500,00</p>
                                </div>
                            </div>
                        </div>
                         <div class="py-3">
                            <p class="text-sm font-bold text-[var(--cor-texto-secundario)] mb-2 px-3">Ontem, 02 de Julho</p>
                            <div class="space-y-1">
                                <div class="transaction-item bg-[var(--fundo-elemento)] p-3 rounded-lg flex justify-between items-center cursor-pointer hover:bg-white/10" data-type="income" data-title="Salário Empresa X" data-category="Salário" data-value="+ R$ 5.000,00" data-date="02 de Julho, 2025" data-account="Conta Salário" data-description="Recebimento do salário mensal.">
                                    <div class="flex items-center"><div class="w-10 h-10 flex items-center justify-center rounded-full bg-[#002147] mr-3"><i data-lucide="briefcase" class="w-5 h-5 text-[var(--cor-receita)]"></i></div><div><p class="font-semibold text-[var(--cor-texto-principal)]">Salário Empresa X</p><p class="text-xs text-[var(--cor-texto-secundario)]">Salário</p></div></div><p class="font-bold text-[var(--cor-receita)]">+ R$ 5.000,00</p>
                                </div>
                                <div class="transaction-item bg-[var(--fundo-elemento)] p-3 rounded-lg flex justify-between items-center cursor-pointer hover:bg-white/10" data-type="expense" data-title="Aluguel" data-category="Moradia" data-value="- R$ 1.500,00" data-date="02 de Julho, 2025" data-account="Conta Corrente" data-description="Pagamento do aluguel do apartamento.">
                                    <div class="flex items-center"><div class="w-10 h-10 flex items-center justify-center rounded-full bg-[#002147] mr-3"><i data-lucide="home" class="w-5 h-5 text-[var(--cor-despesa)]"></i></div><div><p class="font-semibold text-[var(--cor-texto-principal)]">Aluguel</p><p class="text-xs text-[var(--cor-texto-secundario)]">Moradia</p></div></div><p class="font-bold text-[var(--cor-despesa)]">- R$ 1.500,00</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
                <footer class="bg-black/20 absolute bottom-20 left-0 right-0 h-16 backdrop-blur-sm border-t border-[var(--cor-borda)]">
                    <div class="grid grid-cols-3 h-full text-center">
                        <div class="flex flex-col justify-center"><p class="text-xs text-[var(--cor-texto-secundario)]">Entradas</p><p class="font-bold text-[var(--cor-receita)]">R$ 5.000,00</p></div>
                        <div class="flex flex-col justify-center"><p class="text-xs text-[var(--cor-texto-secundario)]">Saídas</p><p class="font-bold text-[var(--cor-despesa)]">-R$ 2.650,20</p></div>
                        <div class="flex flex-col justify-center"><p class="text-xs text-[var(--cor-texto-secundario)]">Saldo</p><p class="font-bold text-[var(--cor-acento-dourado)]">+R$ 2.349,80</p></div>
                    </div>
                </footer>
            </div>
            
            <!-- TELA DE RELATÓRIOS -->
            <div id="screen-3" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]"><h1 class="text-xl font-bold text-[var(--cor-texto-principal)]">Relatórios</h1></header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content pb-24 space-y-5">
                    <div class="flex justify-between items-center text-center">
                        <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer prev-month-btn"></i>
                        <div class="flex-1 flex justify-center items-center space-x-2">
                            <span class="text-[var(--cor-texto-secundario)] prev-month-text"></span>
                            <span class="py-2 px-4 bg-[var(--fundo-elemento)] text-[var(--cor-texto-principal)] font-bold rounded-full month-display"></span>
                            <span class="text-[var(--cor-texto-secundario)] next-month-text"></span>
                        </div>
                        <i data-lucide="chevron-right" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer next-month-btn"></i>
                    </div>
                    <div class="bg-[var(--fundo-elemento)] p-5 rounded-xl">
                        <h3 class="text-md font-semibold text-[var(--cor-texto-principal)] mb-4">Entradas vs Saídas</h3>
                        <div class="h-40"><canvas id="mainBarChart"></canvas></div>
                    </div>
                    <div class="bg-[var(--fundo-elemento)] p-5 rounded-xl">
                        <h3 class="text-md font-semibold text-[var(--cor-texto-principal)] mb-4">Despesas por Categoria</h3>
                        <div class="h-40 mb-4"><canvas id="pieChart"></canvas></div>
                        <div class="space-y-3">
                            <div>
                                <div class="flex justify-between items-center text-sm mb-1">
                                    <span class="flex items-center"><span class="w-2 h-2 rounded-full mr-2" style="background-color: var(--cor-moradia);"></span>Moradia</span>
                                    <span>R$ 1.500,00</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-1.5"><div class="h-1.5 rounded-full" style="width: 56.6%; background-color: var(--cor-moradia);"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center text-sm mb-1">
                                    <span class="flex items-center"><span class="w-2 h-2 rounded-full mr-2" style="background-color: var(--cor-alimentacao);"></span>Alimentação</span>
                                    <span>R$ 650,20</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-1.5"><div class="h-1.5 rounded-full" style="width: 24.5%; background-color: var(--cor-alimentacao);"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center text-sm mb-1">
                                    <span class="flex items-center"><span class="w-2 h-2 rounded-full mr-2" style="background-color: var(--cor-transporte);"></span>Transporte</span>
                                    <span>R$ 500,00</span>
                                </div>
                                <div class="w-full bg-gray-700 rounded-full h-1.5"><div class="h-1.5 rounded-full" style="width: 18.9%; background-color: var(--cor-transporte);"></div></div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

            <!-- TELA DE DETALHE DA META -->
            <div id="screen-4" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                    <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(8)"></i>
                    <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Bares e Restaurantes</h1>
                    <div class="flex items-center space-x-4">
                       <i data-lucide="edit-3" class="w-5 h-5 text-[var(--cor-texto-secundario)] cursor-pointer"></i>
                       <i id="delete-goal-btn" data-lucide="trash-2" class="w-5 h-5 text-[var(--cor-texto-secundario)] cursor-pointer"></i>
                    </div>
                </header>
                <main class="flex-1 overflow-y-auto mobile-screen-content pb-24">
                     <div class="p-4">
                        <div class="flex justify-between items-center text-center">
                            <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer prev-month-btn"></i>
                            <div class="flex-1 flex justify-center items-center space-x-2">
                                <span class="text-[var(--cor-texto-secundario)] prev-month-text"></span>
                                <span class="py-2 px-4 bg-[var(--fundo-elemento)] text-[var(--cor-texto-principal)] font-bold rounded-full month-display"></span>
                                <span class="text-[var(--cor-texto-secundario)] next-month-text"></span>
                            </div>
                            <i data-lucide="chevron-right" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer next-month-btn"></i>
                        </div>
                    </div>

                    <div class="px-4 py-4 flex space-x-4 border-y border-[var(--cor-borda)]">
                        <div class="flex-1">
                            <p class="text-sm text-[var(--cor-texto-secundario)] flex items-center">Disponível <i data-lucide="info" class="w-3 h-3 ml-1"></i></p>
                            <p class="text-2xl font-bold text-[var(--cor-texto-principal)]">R$ 9,00</p>
                            <p class="text-xs text-[var(--cor-texto-secundario)]">de R$ 100,00</p>
                        </div>
                        <div class="w-2.5 h-auto bg-[var(--fundo-elemento)] rounded-full overflow-hidden">
                            <div class="bg-[var(--cor-acento-dourado)] h-full w-full rounded-full" style="transform: translateY(91%);"></div>
                        </div>
                    </div>
                    
                    <div class="px-4 pt-4">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-md font-semibold text-[var(--cor-texto-principal)]">Lançamentos do mês</h3>
                            <i data-lucide="search" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                        </div>
                        <div class="space-y-2">
                            <p class="text-sm font-bold text-[var(--cor-texto-secundario)]">Hoje</p>
                            <div class="flex justify-between items-center py-2 border-b border-[var(--cor-borda)]">
                                <div class="flex items-center"><div class="w-10 h-10 flex items-center justify-center rounded-full bg-[var(--fundo-elemento)] mr-3"><i data-lucide="utensils" class="w-5 h-5 text-[var(--cor-texto-principal)]"></i></div><div><p class="font-semibold text-[var(--cor-texto-principal)]">Bares e Restaurantes</p><p class="text-xs text-[var(--cor-texto-secundario)]">Conta inicial</p></div></div>
                                <div class="text-right">
                                    <p class="font-bold text-[var(--cor-despesa)]">- R$ 90,00</p>
                                    <p class="text-xs text-[var(--cor-texto-secundario)]">pago</p>
                                </div>
                            </div>
                            <div class="flex justify-between items-center py-2">
                                <div class="flex items-center"><div class="w-10 h-10 flex items-center justify-center rounded-full bg-[var(--fundo-elemento)] mr-3"><i data-lucide="utensils" class="w-5 h-5 text-[var(--cor-texto-principal)]"></i></div><div><p class="font-semibold text-[var(--cor-texto-principal)]">Bares e Restaurantes</p><p class="text-xs text-[var(--cor-texto-secundario)]">Conta inicial</p></div></div>
                                <div class="text-right">
                                    <p class="font-bold text-[var(--cor-despesa)]">- R$ 1,00</p>
                                    <p class="text-xs text-[var(--cor-texto-secundario)]">pago</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

            <!-- TELA DE NOVO LANÇAMENTO -->
            <div id="screen-5" class="screen hidden w-full h-full flex flex-col">
                 <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                    <i data-lucide="x" class="w-6 h-6 text-[var(--cor-texto-secundario)] close-modal cursor-pointer"></i>
                    <h1 class="text-xl font-bold text-[var(--cor-texto-principal)]">Novo Lançamento</h1>
                    <button id="save-transaction-btn" class="font-semibold text-[var(--cor-acento-dourado)] hover:opacity-80 transition-opacity">Salvar</button>
                 </header>
                 <main class="flex-1 p-4 overflow-y-auto flex flex-col">
                    <form id="new-transaction-form" class="flex flex-col h-full">
                        <div class="flex-1 space-y-6">
                            <div class="text-center">
                                <label for="transaction-value" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Valor</label>
                                <input type="text" id="transaction-value" required class="text-5xl font-bold text-center w-full bg-transparent border-none focus:ring-0 p-0" placeholder="R$ 0,00">
                            </div>
                            <div>
                                <label for="transaction-name" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Nome</label>
                                <input type="text" id="transaction-name" required class="mt-1 appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md focus:outline-none focus:ring-[var(--cor-acento-dourado)] focus:border-[var(--cor-acento-dourado)] sm:text-sm" placeholder="Ex: Salário, Aluguel">
                            </div>
                            <div>
                                <span class="text-sm font-medium text-[var(--cor-texto-secundario)]">Tipo</span>
                                <div id="transaction-type-selector" class="mt-2 grid grid-cols-3 gap-2 text-sm">
                                    <button type="button" data-type="expense" class="transaction-type-btn py-3 px-3 rounded-md border-2 border-[var(--cor-despesa)] text-[var(--cor-despesa)]" style="--cor-selecionada: var(--cor-despesa);">Despesa</button>
                                    <button type="button" data-type="income" class="transaction-type-btn py-3 px-3 rounded-md border-2 border-[var(--cor-receita)] text-[var(--cor-receita)]" style="--cor-selecionada: var(--cor-receita);">Receita</button>
                                    <button type="button" data-type="transfer" class="transaction-type-btn py-3 px-3 rounded-md border-2 border-[var(--cor-transferencia)] text-[var(--cor-transferencia)]" style="--cor-selecionada: var(--cor-transferencia);">Transferência</button>
                                </div>
                            </div>
                            <div id="category-selector-wrapper" class="hidden">
                                <label for="transaction-category" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Categoria</label>
                                <div id="category-buttons-container" class="mt-2 flex flex-wrap gap-2">
                                </div>
                            </div>
                        </div>
                    </form>
                 </main>
            </div>
            
            <!-- TELA DE DETALHE DO LANÇAMENTO -->
            <div id="screen-6" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                   <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(2)"></i>
                   <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]" id="detail-title">Detalhe da Transação</h1>
                   <div class="w-6"></div>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content pb-24 space-y-4">
                    <div class="text-center py-4">
                        <p class="text-4xl font-bold" id="detail-value"></p>
                        <p class="font-semibold text-[var(--cor-texto-principal)]" id="detail-name"></p>
                    </div>
                    <div class="bg-[var(--fundo-elemento)] p-4 rounded-lg space-y-3">
                        <div class="flex justify-between text-sm">
                            <span class="text-[var(--cor-texto-secundario)]">Categoria</span>
                            <span class="font-medium" id="detail-category"></span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-[var(--cor-texto-secundario)]">Data</span>
                            <span class="font-medium" id="detail-date"></span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-[var(--cor-texto-secundario)]">Conta</span>
                            <span class="font-medium" id="detail-account"></span>
                        </div>
                        <div>
                            <span class="text-sm text-[var(--cor-texto-secundario)]">Descrição</span>
                            <p class="text-sm font-medium mt-1" id="detail-description"></p>
                        </div>
                    </div>
                </main>
                 <footer class="absolute bottom-0 left-0 right-0 p-4">
                    <div class="flex space-x-4">
                        <button id="edit-transaction-btn" class="w-full py-3 text-sm font-bold rounded-md text-[var(--cor-texto-principal)] bg-[var(--fundo-elemento)] hover:opacity-80">Editar</button>
                        <button id="delete-transaction-btn" class="w-full py-3 text-sm font-bold rounded-md text-white bg-[var(--cor-despesa)] hover:opacity-80">Excluir</button>
                    </div>
                </footer>
            </div>

            <!-- TELA DE PERFIL -->
            <div id="screen-7" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                   <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(1)"></i>
                   <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Perfil</h1>
                   <div class="w-6"></div>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content pb-24 flex flex-col items-center">
                    <div class="relative mt-8 mb-4">
                        <img class="w-24 h-24 rounded-full border-4 border-[var(--cor-acento-dourado)]" src="https://placehold.co/100x100/0a2b52/C4A35A?text=U" alt="Avatar do usuário">
                        <button class="absolute bottom-0 right-0 bg-[var(--cor-acento-dourado)] text-black w-7 h-7 rounded-full flex items-center justify-center shadow-md">
                            <i data-lucide="camera" class="w-4 h-4"></i>
                        </button>
                    </div>
                    <p class="text-xl font-bold">Usuário</p>
                    <p class="text-sm text-[var(--cor-texto-secundario)] mb-8">usuario@email.com</p>
                    
                    <div class="w-full space-y-2">
                        <a href="#" class="flex items-center justify-between p-4 bg-[var(--fundo-elemento)] rounded-lg w-full text-left hover:bg-white/10 transition-colors" onclick="showScreen(11)">
                            <span class="flex items-center"><i data-lucide="user" class="w-5 h-5 mr-3 text-[var(--cor-acento-dourado)]"></i>Editar Perfil</span>
                            <i data-lucide="chevron-right" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                        </a>
                        <a href="#" class="flex items-center justify-between p-4 bg-[var(--fundo-elemento)] rounded-lg w-full text-left hover:bg-white/10 transition-colors" onclick="showScreen(10)">
                            <span class="flex items-center"><i data-lucide="settings" class="w-5 h-5 mr-3 text-[var(--cor-acento-dourado)]"></i>Configurações</span>
                            <i data-lucide="chevron-right" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                        </a>
                        <a href="#" class="flex items-center justify-between p-4 bg-[var(--fundo-elemento)] rounded-lg w-full text-left hover:bg-white/10 transition-colors" onclick="showScreen(12)">
                            <span class="flex items-center"><i data-lucide="shield" class="w-5 h-5 mr-3 text-[var(--cor-acento-dourado)]"></i>Segurança</span>
                            <i data-lucide="chevron-right" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                        </a>
                        <a href="#" onclick="showScreen(0)" class="flex items-center justify-between p-4 bg-[var(--fundo-elemento)] rounded-lg w-full text-left hover:bg-white/10 transition-colors">
                            <span class="flex items-center"><i data-lucide="log-out" class="w-5 h-5 mr-3 text-[var(--cor-despesa)]"></i>Sair</span>
                        </a>
                    </div>
                </main>
            </div>

            <!-- TELA DE DASHBOARD DE METAS -->
            <div id="screen-8" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]"><h1 class="text-xl font-bold text-[var(--cor-texto-principal)]">Metas</h1></header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content pb-24 space-y-4">
                    <div class="goal-card bg-[var(--fundo-elemento)] p-4 rounded-lg cursor-pointer hover:bg-white/10 transition-colors" onclick="showScreen(4)">
                        <div class="flex items-center mb-3">
                            <div class="w-10 h-10 flex items-center justify-center rounded-full bg-[var(--fundo-principal)] mr-3"><i data-lucide="utensils" class="w-5 h-5 text-[var(--cor-alimentacao)]"></i></div>
                            <p class="font-semibold text-[var(--cor-texto-principal)]">Bares e Restaurantes</p>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2.5 mb-1"><div class="bg-[var(--cor-alimentacao)] h-2.5 rounded-full" style="width: 9%"></div></div>
                        <p class="text-xs text-[var(--cor-texto-secundario)] text-right">R$ 9,00 de R$ 100,00</p>
                    </div>
                    <div class="goal-card bg-[var(--fundo-elemento)] p-4 rounded-lg cursor-pointer hover:bg-white/10 transition-colors">
                        <div class="flex items-center mb-3">
                            <div class="w-10 h-10 flex items-center justify-center rounded-full bg-[var(--fundo-principal)] mr-3"><i data-lucide="plane" class="w-5 h-5 text-[var(--cor-viagem)]"></i></div>
                            <p class="font-semibold text-[var(--cor-texto-principal)]">Viagem de Férias</p>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2.5 mb-1"><div class="bg-[var(--cor-viagem)] h-2.5 rounded-full" style="width: 75%"></div></div>
                        <p class="text-xs text-[var(--cor-texto-secundario)] text-right">R$ 3.750,00 de R$ 5.000,00</p>
                    </div>
                </main>
            </div>
            
             <!-- TELA DE NOTIFICAÇÕES -->
            <div id="screen-9" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                   <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(1)"></i>
                   <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Notificações</h1>
                   <div class="w-6"></div>
                </header>
                <main class="flex-1 overflow-y-auto mobile-screen-content">
                    <div class="p-4 space-y-4">
                        <div class="flex items-start space-x-3 bg-[var(--fundo-elemento)] p-3 rounded-lg">
                            <div class="w-10 h-10 flex items-center justify-center rounded-full bg-[var(--cor-despesa)]/20 text-[var(--cor-despesa)]"><i data-lucide="calendar-clock"></i></div>
                            <div>
                                <p class="font-semibold">Lembrete de Pagamento</p>
                                <p class="text-sm text-[var(--cor-texto-secundario)]">Sua conta de Aluguel no valor de R$ 1.500,00 vence amanhã.</p>
                                <p class="text-xs text-gray-500 mt-1">Hoje, 09:30</p>
                            </div>
                        </div>
                         <div class="flex items-start space-x-3 bg-[var(--fundo-elemento)] p-3 rounded-lg">
                            <div class="w-10 h-10 flex items-center justify-center rounded-full bg-[var(--cor-viagem)]/20 text-[var(--cor-viagem)]"><i data-lucide="target"></i></div>
                            <div>
                                <p class="font-semibold">Meta Quase Atingida!</p>
                                <p class="text-sm text-[var(--cor-texto-secundario)]">Você já alcançou 75% da sua meta "Viagem de Férias". Continue assim!</p>
                                <p class="text-xs text-gray-500 mt-1">Ontem, 18:45</p>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

            <!-- TELA DE CONFIGURAÇÕES -->
            <div id="screen-10" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                   <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(7)"></i>
                   <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Configurações</h1>
                   <div class="w-6"></div>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content space-y-4">
                    <div>
                        <h3 class="text-sm font-semibold text-[var(--cor-texto-secundario)] px-4 mb-2">APARÊNCIA</h3>
                        <div class="bg-[var(--fundo-elemento)] p-4 rounded-lg">
                             <div class="flex justify-between items-center">
                                <span class="font-medium">Tema</span>
                                <div class="flex items-center gap-2 bg-[var(--fundo-principal)] p-1 rounded-full">
                                    <button class="theme-btn selected px-3 py-1 rounded-full text-sm" style="--cor-selecionada: var(--cor-acento-dourado);">Escuro</button>
                                    <button class="theme-btn px-3 py-1 rounded-full text-sm">Claro</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-sm font-semibold text-[var(--cor-texto-secundario)] px-4 mb-2">GERAL</h3>
                        <div class="bg-[var(--fundo-elemento)] rounded-lg divide-y divide-[var(--cor-borda)]">
                            <a href="#" class="flex items-center justify-between p-4 w-full text-left hover:bg-white/10 transition-colors" onclick="showScreen(9)">
                                <span>Notificações</span>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                            </a>
                            <a href="#" class="flex items-center justify-between p-4 w-full text-left hover:bg-white/10 transition-colors">
                                <span>Contas Conectadas</span>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                            </a>
                            <a href="#" class="flex items-center justify-between p-4 w-full text-left hover:bg-white/10 transition-colors">
                                <span>Ajuda e Suporte</span>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                            </a>
                        </div>
                    </div>
                </main>
            </div>

            <!-- TELA DE EDITAR PERFIL -->
            <div id="screen-11" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                   <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(7)"></i>
                   <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Editar Perfil</h1>
                   <button class="font-semibold text-[var(--cor-acento-dourado)] hover:opacity-80 transition-opacity">Salvar</button>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content space-y-4">
                     <div class="flex flex-col items-center mt-4">
                        <div class="relative mb-4">
                            <img class="w-24 h-24 rounded-full border-4 border-[var(--cor-acento-dourado)]" src="https://placehold.co/100x100/0a2b52/C4A35A?text=U" alt="Avatar do usuário">
                            <button class="absolute bottom-0 right-0 bg-[var(--cor-acento-dourado)] text-black w-7 h-7 rounded-full flex items-center justify-center shadow-md">
                                <i data-lucide="camera" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                    <form class="space-y-4">
                         <div>
                            <label for="profile-name" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Nome</label>
                            <input type="text" id="profile-name" value="Usuário" class="mt-1 appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md focus:outline-none focus:ring-[var(--cor-acento-dourado)] focus:border-[var(--cor-acento-dourado)] sm:text-sm">
                        </div>
                         <div>
                            <label for="profile-email" class="text-sm font-medium text-[var(--cor-texto-secundario)]">Email</label>
                            <input type="email" id="profile-email" value="usuario@email.com" class="mt-1 appearance-none block w-full px-3 py-3 bg-[var(--fundo-elemento)] border border-[var(--cor-borda)] placeholder-[var(--cor-texto-secundario)] text-[var(--cor-texto-principal)] rounded-md focus:outline-none focus:ring-[var(--cor-acento-dourado)] focus:border-[var(--cor-acento-dourado)] sm:text-sm">
                        </div>
                    </form>
                </main>
            </div>

            <!-- TELA DE SEGURANÇA -->
            <div id="screen-12" class="screen hidden w-full h-full flex flex-col">
                <header class="flex items-center justify-between h-16 px-4 shrink-0 border-b border-[var(--cor-borda)]">
                   <i data-lucide="chevron-left" class="w-6 h-6 text-[var(--cor-texto-secundario)] cursor-pointer" onclick="showScreen(7)"></i>
                   <h1 class="text-lg font-semibold text-[var(--cor-texto-principal)]">Segurança</h1>
                   <div class="w-6"></div>
                </header>
                <main class="flex-1 p-4 overflow-y-auto mobile-screen-content">
                    <div class="bg-[var(--fundo-elemento)] rounded-lg divide-y divide-[var(--cor-borda)]">
                        <a href="#" class="flex items-center justify-between p-4 w-full text-left hover:bg-white/10 transition-colors">
                            <span>Alterar Senha</span>
                            <i data-lucide="chevron-right" class="w-5 h-5 text-[var(--cor-texto-secundario)]"></i>
                        </a>
                        <div class="flex items-center justify-between p-4 w-full text-left">
                            <span>Autenticação de 2 Fatores</span>
                            <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                                <input type="checkbox" name="toggle" id="security-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                                <label for="security-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                            </div>
                        </div>
                    </div>
                </main>
            </div>

            <!-- MODAL DE CONFIRMAÇÃO -->
            <div id="confirmation-modal" class="hidden absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                <div class="bg-[var(--fundo-card)] p-6 rounded-xl shadow-lg w-full max-w-xs text-center">
                    <p id="modal-message" class="mb-6">Tem certeza que deseja excluir este item?</p>
                    <div class="flex space-x-4">
                        <button id="modal-cancel-btn" class="w-full py-2 text-sm font-bold rounded-md text-[var(--cor-texto-principal)] bg-[var(--fundo-elemento)] hover:opacity-80">Cancelar</button>
                        <button id="modal-confirm-btn" class="w-full py-2 text-sm font-bold rounded-md text-white bg-[var(--cor-despesa)] hover:opacity-80">Excluir</button>
                    </div>
                </div>
            </div>


            <!-- NAVEGAÇÃO INFERIOR -->
            <nav class="absolute bottom-0 left-0 right-0 h-20 bg-black/20 backdrop-blur-lg border-t border-[var(--cor-borda)]">
                <div class="relative flex justify-around items-center h-full">
                    <a href="#" class="nav-link flex flex-col items-center justify-center h-full text-[var(--cor-texto-secundario)] w-1/5" data-screen="1"><i data-lucide="layout-dashboard" class="w-6 h-6"></i><span class="text-[10px] mt-1">Dashboard</span></a>
                    <a href="#" class="nav-link flex flex-col items-center justify-center h-full text-[var(--cor-texto-secundario)] w-1/5" data-screen="2"><i data-lucide="arrow-right-left" class="w-6 h-6"></i><span class="text-[10px] mt-1">Lançamentos</span></a>
                    <a href="#" class="nav-link flex flex-col items-center justify-center h-full " data-screen="2"><i class="w-6 h-6"></i><span class="text-[10px] mt-1"></span></a>
                    <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2">
                        <a href="#" class="nav-link" data-screen="5">
                            <div class="bg-[var(--cor-acento-dourado)] text-[var(--fundo-principal)] w-12 h-12 rounded-2xl flex items-center justify-center shadow-lg hover:bg-[var(--cor-acento-dourado-hover)] transition-colors">
                               <i data-lucide="plus" class="w-6 h-6"></i>
                           </div>
                        </a>
                    </div>
                    <a href="#" class="nav-link flex flex-col items-center justify-center h-full text-[var(--cor-texto-secundario)] w-1/5" data-screen="3"><i data-lucide="pie-chart" class="w-6 h-6"></i><span class="text-[10px] mt-1">Relatórios</span></a>
                    <a href="#" class="nav-link flex flex-col items-center justify-center h-full text-[var(--cor-texto-secundario)] w-1/5" data-screen="8"><i data-lucide="target" class="w-6 h-6"></i><span class="text-[10px] mt-1">Metas</span></a>
                </div>
            </nav>
            
            <!-- Botão de Controle (fora do celular) -->
            <div class="fixed top-4 right-4 flex flex-col space-y-3 z-50">
                <button id="next-screen-btn" class="bg-[var(--cor-acento-dourado)] text-[var(--fundo-principal)] p-3 rounded-full shadow-lg hover:bg-[var(--cor-acento-dourado-hover)] transition-opacity">
                    <i data-lucide="arrow-right-circle"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        let currentScreenIndex = 0;
        const navLinks = document.querySelectorAll('.nav-link');
        const nextButton = document.getElementById('next-screen-btn');
        let barChartInstance, pieChartInstance;
        const months = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
        let currentDate = new Date(2025, 6, 1); // Julho 2025
        
        const incomeCategories = ['Salário', 'Vendas', 'Investimentos', 'Outras Receitas'];
        const expenseCategories = ['Moradia', 'Alimentação', 'Transporte', 'Lazer', 'Saúde', 'Educação', 'Outras Despesas'];
        let currentTransactionToEdit = null;

        // Função para obter cores do CSS
        const getCssVar = (name) => getComputedStyle(document.documentElement).getPropertyValue(name).trim();

        function updateNav(activeIndex) {
            navLinks.forEach(link => {
                const screen = link.getAttribute('data-screen');
                if (!screen || screen === '5') return;
                
                const icon = link.querySelector('i');
                const text = link.querySelector('span');
                const activeColor = getCssVar('--cor-acento-dourado');
                const inactiveColor = getCssVar('--cor-texto-secundario');

                if (screen == activeIndex) {
                    link.style.color = activeColor;
                    if(text) text.classList.add('font-semibold');
                } else {
                    link.style.color = inactiveColor;
                    if(text) text.classList.remove('font-semibold');
                }
            });
        }

        function updateAllMonthDisplays() {
            const displayMonth = months[currentDate.getMonth()];
            const displayYear = currentDate.getFullYear();
            
            const prevDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);
            const prevMonth = months[prevDate.getMonth()];
            const prevYear = prevDate.getFullYear();

            const nextDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1);
            const nextMonth = months[nextDate.getMonth()];
            const nextYear = nextDate.getFullYear();

            document.querySelectorAll('.month-display').forEach(el => {
                el.innerText = `${displayMonth} ${displayYear}`;
            });

            document.querySelectorAll('.prev-month-text').forEach(el => {
                el.innerText = `${prevMonth} ${prevYear}`;
            });
            
            document.querySelectorAll('.next-month-text').forEach(el => {
                el.innerText = `${nextMonth} ${nextYear}`;
            });
        }

        function showScreen(index) {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            
            const currentScreenEl = document.getElementById(`screen-${index}`);
            if(currentScreenEl) {
                currentScreenEl.classList.remove('hidden');
                currentScreenIndex = index;
                
                const nav = document.querySelector('nav');
                const nextBtnContainer = nextButton.parentElement;

                // Mostra o botão de navegação em todas as telas
                nextBtnContainer.classList.remove('hidden');

                // Esconde a barra de navegação inferior em telas específicas
                if ([0, 6, 7, 9, 10, 11, 12].includes(index)) { 
                    nav.classList.add('hidden');
                } else {
                    nav.classList.remove('hidden');
                }

                if ([1,2,3,8].includes(index)) { // Telas principais com navegação
                    updateNav(index);
                }
                if (index === 3) {
                    createOrUpdateCharts();
                }
                if (index === 5) {
                    // Se não houver transação para editar, reseta o formulário
                    if (!currentTransactionToEdit) {
                        document.getElementById('new-transaction-form').reset();
                        document.querySelectorAll('.transaction-type-btn').forEach(btn => {
                            btn.classList.remove('selected');
                            btn.style.backgroundColor = 'transparent';
                        });
                        updateCategorySelector(null);
                    }
                }
            }
        }
        
        function showTransactionDetail(element) {
            currentTransactionToEdit = element; // Armazena o elemento para edição/exclusão
            const title = element.dataset.title;
            const value = element.dataset.value;
            const category = element.dataset.category;
            const date = element.dataset.date;
            const account = element.dataset.account;
            const description = element.dataset.description;
            const type = element.dataset.type;

            // Popula a tela de detalhes
            document.getElementById('detail-name').innerText = title;
            const valueEl = document.getElementById('detail-value');
            valueEl.innerText = value;
            document.getElementById('detail-category').innerText = category;
            document.getElementById('detail-date').innerText = date;
            document.getElementById('detail-account').innerText = account;
            document.getElementById('detail-description').innerText = description;
            
            // Ajusta a cor do valor com base no tipo
            switch (type) {
                case 'income':
                    valueEl.style.color = getCssVar('--cor-receita');
                    break;
                case 'expense':
                    valueEl.style.color = getCssVar('--cor-despesa');
                    break;
                case 'transfer':
                    valueEl.style.color = getCssVar('--cor-transferencia');
                    break;
                default:
                    valueEl.style.color = getCssVar('--cor-texto-principal');
            }
            
            // Mostra a tela de detalhes
            showScreen(6);
        }
        
        function updateCategorySelector(type) {
            const wrapper = document.getElementById('category-selector-wrapper');
            const container = document.getElementById('category-buttons-container');
            container.innerHTML = ''; // Limpa botões existentes

            let categories = [];
            if (type === 'income') {
                categories = incomeCategories;
                wrapper.classList.remove('hidden');
            } else if (type === 'expense') {
                categories = expenseCategories;
                wrapper.classList.remove('hidden');
            } else { // transfer ou nulo
                wrapper.classList.add('hidden');
                return; // Sai da função se não for income/expense
            }

            categories.forEach(cat => {
                const button = document.createElement('button');
                button.type = 'button';
                button.dataset.category = cat;
                button.innerText = cat;
                button.className = 'category-btn py-2 px-4 rounded-full text-sm border-2 border-[var(--cor-texto-secundario)] text-[var(--cor-texto-secundario)] transition-colors';
                
                button.addEventListener('click', () => {
                    // Remove 'selected' de todos os botões de categoria
                    container.querySelectorAll('button').forEach(btn => {
                        btn.classList.remove('selected');
                        btn.style.backgroundColor = 'transparent';
                        btn.style.color = getCssVar('--cor-texto-secundario');
                        btn.style.borderColor = getCssVar('--cor-texto-secundario');
                    });
                    // Adiciona 'selected' ao botão clicado
                    button.classList.add('selected');
                    button.style.backgroundColor = getCssVar('--cor-acento-dourado');
                    button.style.color = 'black';
                    button.style.borderColor = getCssVar('--cor-acento-dourado');
                });
                
                container.appendChild(button);
            });
        }

        function showConfirmationModal(message, onConfirm) {
            const modal = document.getElementById('confirmation-modal');
            document.getElementById('modal-message').innerText = message;
            modal.classList.remove('hidden');

            const confirmBtn = document.getElementById('modal-confirm-btn');
            const cancelBtn = document.getElementById('modal-cancel-btn');

            const confirmHandler = () => {
                onConfirm();
                hideModal();
            };
            
            const cancelHandler = () => {
                hideModal();
            };

            const hideModal = () => {
                modal.classList.add('hidden');
                confirmBtn.removeEventListener('click', confirmHandler);
                cancelBtn.removeEventListener('click', cancelHandler);
            };

            confirmBtn.addEventListener('click', confirmHandler, { once: true });
            cancelBtn.addEventListener('click', cancelHandler, { once: true });
        }

        nextButton.addEventListener('click', () => {
            const mainScreens = [0, 1, 2, 3, 8, 7, 9]; // Sequência de navegação principal
            let currentIndexInSequence = mainScreens.indexOf(currentScreenIndex);
            if (currentIndexInSequence === -1) { 
                currentIndexInSequence = 1; // Se estiver fora da sequência, volta pro dashboard
            }
            const nextIndexInSequence = (currentIndexInSequence + 1) % mainScreens.length;
            const nextScreenId = mainScreens[nextIndexInSequence];
            showScreen(nextScreenId);
        });

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => { 
                e.preventDefault(); 
                const screenIndex = parseInt(link.getAttribute('data-screen'), 10);
                showScreen(screenIndex);
            });
        });

        // Eventos de clique
        document.querySelector('#screen-0 form button').addEventListener('click', () => showScreen(1));
        document.getElementById('profile-pic').addEventListener('click', () => showScreen(7));
        document.getElementById('notifications-btn').addEventListener('click', () => showScreen(9));
        document.querySelectorAll('.close-modal').forEach(btn => btn.addEventListener('click', () => showScreen(2)));
        document.querySelectorAll('.transaction-item').forEach(item => item.addEventListener('click', () => showTransactionDetail(item)));
        
        // Botão Salvar no formulário
        document.getElementById('save-transaction-btn').addEventListener('click', () => {
            document.getElementById('new-transaction-form').dispatchEvent(new Event('submit', { cancelable: true, bubbles: true }));
        });

        // Lógica para o formulário de novo lançamento
        const typeButtons = document.querySelectorAll('.transaction-type-btn');
        typeButtons.forEach(button => {
            button.addEventListener('click', () => {
                typeButtons.forEach(btn => {
                    btn.classList.remove('selected');
                    btn.style.backgroundColor = 'transparent'; // Reseta o fundo
                });
                button.classList.add('selected');
                const selectedColor = getCssVar(`--cor-${button.dataset.type}`);
                button.style.backgroundColor = selectedColor;
                button.style.borderColor = selectedColor;
                updateCategorySelector(button.dataset.type);
            });
        });

        document.getElementById('new-transaction-form').addEventListener('submit', (e) => {
            e.preventDefault();
            // Aqui iria a lógica para salvar os dados
            currentTransactionToEdit = null; // Limpa item em edição
            showScreen(2); // Volta para a tela de lançamentos
        });
        
        // Lógica para os botões de navegação de mês
        document.querySelectorAll('.prev-month-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                updateAllMonthDisplays();
            });
        });

        document.querySelectorAll('.next-month-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                updateAllMonthDisplays();
            });
        });
        
        // Lógica dos botões de editar e excluir
        document.getElementById('delete-transaction-btn').addEventListener('click', () => {
            showConfirmationModal('Deseja realmente excluir este lançamento?', () => {
                // Lógica de exclusão aqui
                currentTransactionToEdit.remove();
                showScreen(2);
            });
        });

        document.getElementById('edit-transaction-btn').addEventListener('click', () => {
            if (!currentTransactionToEdit) return;
            const { type, title, value, category } = currentTransactionToEdit.dataset;
            
            // Popula o formulário
            document.getElementById('transaction-name').value = title;
            document.getElementById('transaction-value').value = parseFloat(value.replace(/[^0-9,-]+/g,"").replace(",","."));
            
            const typeBtn = document.querySelector(`.transaction-type-btn[data-type="${type}"]`);
            if (typeBtn) typeBtn.click();
            
            document.getElementById('transaction-category').value = category;

            showScreen(5);
        });

        document.getElementById('delete-goal-btn').addEventListener('click', () => {
            showConfirmationModal('Deseja realmente excluir esta meta?', () => {
                // Lógica de exclusão da meta aqui
                showScreen(8);
            });
        });

        // Lógica dos filtros
        const filterButtons = document.querySelectorAll('.filter-btn');
        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                filterButtons.forEach(btn => btn.classList.remove('selected'));
                button.classList.add('selected');
                const filter = button.dataset.filter;
                const items = document.querySelectorAll('#transaction-list .transaction-item');
                items.forEach(item => {
                    const type = item.dataset.type;
                    if (filter === 'all' || type === filter) {
                        item.style.display = 'flex';
                    } else if (filter === 'expense' && (type === 'expense' || type === 'transfer')) {
                         item.style.display = 'flex';
                    }
                    else {
                        item.style.display = 'none';
                    }
                });
            });
        });


        function createOrUpdateCharts() {
            if (barChartInstance) { barChartInstance.destroy(); }
            if (pieChartInstance) { pieChartInstance.destroy(); }
            
            const textColor = getCssVar('--cor-texto-secundario');
            const gridColor = getCssVar('--cor-borda');

            const barCtx = document.getElementById('mainBarChart').getContext('2d');
            barChartInstance = new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: ['Abr', 'Mai', 'Jun', 'Jul'],
                    datasets: [{
                        label: 'Receitas',
                        data: [5200, 5300, 5500, 5000],
                        backgroundColor: getCssVar('--cor-receita'),
                        borderRadius: 4,
                    }, {
                        label: 'Despesas',
                        data: [3400, 3800, 4100, 2650],
                        backgroundColor: getCssVar('--cor-despesa'),
                        borderRadius: 4,
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, ticks: { color: textColor }, grid: { color: gridColor } },
                        x: { ticks: { color: textColor }, grid: { display: false } }
                    }
                }
            });

            const pieCtx = document.getElementById('pieChart').getContext('2d');
            pieChartInstance = new Chart(pieCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Moradia', 'Alimentação', 'Transporte'],
                    datasets: [{
                        data: [1500, 650.20, 500],
                        backgroundColor: [
                            getCssVar('--cor-moradia'),
                            getCssVar('--cor-alimentacao'),
                            getCssVar('--cor-transporte')
                        ],
                        borderColor: getCssVar('--fundo-elemento'),
                        borderWidth: 4,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) { label += ': '; }
                                    if (context.parsed !== null) {
                                        label += new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(context.parsed);
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }

        window.onload = () => {
            showScreen(0);
            updateAllMonthDisplays();
        };
    </script>
</body>
</html>
